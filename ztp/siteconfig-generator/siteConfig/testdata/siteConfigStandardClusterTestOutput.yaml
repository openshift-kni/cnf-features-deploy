---
apiVersion: v1
kind: Namespace
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "0"
    labels:
        name: cluster1
    name: cluster1
---
apiVersion: extensions.hive.openshift.io/v1beta1
kind: AgentClusterInstall
metadata:
    annotations:
        agent-install.openshift.io/install-config-overrides: '{"networking":{"networkType":"OVNKubernetes"}}'
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    clusterDeploymentRef:
        name: cluster1
    imageSetRef:
        name: openshift-v4.9.0
    manifestsConfigMapRef:
        name: cluster1
    networking:
        clusterNetwork:
            - cidr: 10.128.0.0/14
              hostPrefix: 23
        machineNetwork:
            - cidr: 10.16.231.0/24
        serviceNetwork:
            - 172.30.0.0/16
    provisionRequirements:
        controlPlaneAgents: 3
    sshPublicKey: 'ssh-rsa '
---
apiVersion: hive.openshift.io/v1
kind: ClusterDeployment
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    baseDomain: example.com
    clusterInstallRef:
        group: extensions.hive.openshift.io
        kind: AgentClusterInstall
        name: cluster1
        version: v1beta1
    clusterName: cluster1
    platform:
        agentBareMetal:
            agentSelector:
                matchLabels:
                    cluster-name: cluster1
    pullSecretRef:
        name: pullSecretName
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node1
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:30"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node2
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:40"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node3
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:50"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: InfraEnv
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    clusterRef:
        name: cluster1
        namespace: cluster1
    nmStateConfigLabelSelector:
        matchLabels:
            nmstate-label: cluster1
    pullSecretRef:
        name: pullSecretName
    sshAuthorizedKey: 'ssh-rsa '
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node1
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node1
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node2
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node2
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node3
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node3
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: v1
data:
    01-container-mount-ns-and-kubelet-conf-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: container-mount-namespace-and-kubelet-conf-master
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
                mode: 493
                path: /usr/local/bin/extractExecStart
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
                mode: 493
                path: /usr/local/bin/nsenterCmns
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

                  [Service]
                  Type=oneshot
                  RemainAfterExit=yes
                  RuntimeDirectory=container-mount-namespace
                  Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
                  Environment=BIND_POINT=%t/container-mount-namespace/mnt
                  ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
                  ExecStartPre=touch ${BIND_POINT}
                  ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
                  ExecStop=umount -R ${RUNTIME_DIRECTORY}
                enabled: true
                name: container-mount-namespace.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART}"
                  name: 90-container-mount-namespace.conf
                name: crio.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART} --housekeeping-interval=30s"
                  name: 90-container-mount-namespace.conf
                - contents: |
                    [Service]
                    Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                    Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
                  name: 30-kubelet-interval-tuning.conf
                name: kubelet.service
    01-container-mount-ns-and-kubelet-conf-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: container-mount-namespace-and-kubelet-conf-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
                mode: 493
                path: /usr/local/bin/extractExecStart
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
                mode: 493
                path: /usr/local/bin/nsenterCmns
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

                  [Service]
                  Type=oneshot
                  RemainAfterExit=yes
                  RuntimeDirectory=container-mount-namespace
                  Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
                  Environment=BIND_POINT=%t/container-mount-namespace/mnt
                  ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
                  ExecStartPre=touch ${BIND_POINT}
                  ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
                  ExecStop=umount -R ${RUNTIME_DIRECTORY}
                enabled: true
                name: container-mount-namespace.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART}"
                  name: 90-container-mount-namespace.conf
                name: crio.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART} --housekeeping-interval=30s"
                  name: 90-container-mount-namespace.conf
                - contents: |
                    [Service]
                    Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                    Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
                  name: 30-kubelet-interval-tuning.conf
                name: kubelet.service
    03-sctp-machine-config-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: load-sctp-module-master
        spec:
          config:
            ignition:
              version: 2.2.0
            storage:
              files:
                - contents:
                    source: data:,
                    verification: {}
                  filesystem: root
                  mode: 420
                  path: /etc/modprobe.d/sctp-blacklist.conf
                - contents:
                    source: data:text/plain;charset=utf-8,sctp
                  filesystem: root
                  mode: 420
                  path: /etc/modules-load.d/sctp-load.conf
    03-sctp-machine-config-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: load-sctp-module-worker
        spec:
          config:
            ignition:
              version: 2.2.0
            storage:
              files:
                - contents:
                    source: data:,
                    verification: {}
                  filesystem: root
                  mode: 420
                  path: /etc/modprobe.d/sctp-blacklist.conf
                - contents:
                    source: data:text/plain;charset=utf-8,sctp
                  filesystem: root
                  mode: 420
                  path: /etc/modules-load.d/sctp-load.conf
    04-accelerated-container-startup-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: 04-accelerated-container-startup-master
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIwojIFRlbXBvcmFyaWx5IHJlc2V0IHRoZSBjb3JlIHN5c3RlbSBwcm9jZXNzZXMncyBDUFUgYWZmaW5pdHkgdG8gYmUgdW5yZXN0cmljdGVkIHRvIGFjY2VsZXJhdGUgc3RhcnR1cCBhbmQgc2h1dGRvd24KIwojIFRoZSBkZWZhdWx0cyBiZWxvdyBjYW4gYmUgb3ZlcnJpZGRlbiB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzCiMKCiMgVGhlIGRlZmF1bHQgc2V0IG9mIGNyaXRpY2FsIHByb2Nlc3NlcyB3aG9zZSBhZmZpbml0eSBzaG91bGQgYmUgdGVtcG9yYXJpbHkgdW5ib3VuZDoKQ1JJVElDQUxfUFJPQ0VTU0VTPSR7Q1JJVElDQUxfUFJPQ0VTU0VTOi0ic3lzdGVtZCBjcmlvIGt1YmVsZXQgTmV0d29ya01hbmFnZXIgY29ubW9uIGRidXMifQoKIyBEZWZhdWx0IHdhaXQgdGltZSBpcyA2MDBzID0gMTBtOgpNQVhJTVVNX1dBSVRfVElNRT0ke01BWElNVU1fV0FJVF9USU1FOi02MDB9CgojIERlZmF1bHQgc3RlYWR5LXN0YXRlIHRocmVzaG9sZCA9IDIlCiMgQWxsb3dlZCB2YWx1ZXM6CiMgIDQgIC0gYWJzb2x1dGUgcG9kIGNvdW50ICgrLy0pCiMgIDQlIC0gcGVyY2VudCBjaGFuZ2UgKCsvLSkKIyAgLTEgLSBkaXNhYmxlIHRoZSBzdGVhZHktc3RhdGUgY2hlY2sKU1RFQURZX1NUQVRFX1RIUkVTSE9MRD0ke1NURUFEWV9TVEFURV9USFJFU0hPTEQ6LTIlfQoKIyBEZWZhdWx0IHN0ZWFkeS1zdGF0ZSB3aW5kb3cgPSA2MHMKIyBJZiB0aGUgcnVubmluZyBwb2QgY291bnQgc3RheXMgd2l0aGluIHRoZSBnaXZlbiB0aHJlc2hvbGQgZm9yIHRoaXMgdGltZQojIHBlcmlvZCwgcmV0dXJuIENQVSB1dGlsaXphdGlvbiB0byBub3JtYWwgYmVmb3JlIHRoZSBtYXhpbXVtIHdhaXQgdGltZSBoYXMKIyBleHBpcmVzClNURUFEWV9TVEFURV9XSU5ET1c9JHtTVEVBRFlfU1RBVEVfV0lORE9XOi02MH0KCiMgRGVmYXVsdCBzdGVhZHktc3RhdGUgYWxsb3dzIGFueSBwb2QgY291bnQgdG8gYmUgInN0ZWFkeSBzdGF0ZSIKIyBJbmNyZWFzaW5nIHRoaXMgd2lsbCBza2lwIGFueSBzdGVhZHktc3RhdGUgY2hlY2tzIHVudGlsIHRoZSBjb3VudCByaXNlcyBhYm92ZQojIHRoaXMgbnVtYmVyIHRvIGF2b2lkIGZhbHNlIHBvc2l0aXZlcyBpZiB0aGVyZSBhcmUgc29tZSBwZXJpb2RzIHdoZXJlIHRoZQojIGNvdW50IGRvZXNuJ3QgaW5jcmVhc2UgYnV0IHdlIGtub3cgd2UgY2FuJ3QgYmUgYXQgc3RlYWR5LXN0YXRlIHlldC4KU1RFQURZX1NUQVRFX01JTklNVU09JHtTVEVBRFlfU1RBVEVfTUlOSU1VTTotMH0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCktVQkVMRVRfQ1BVX1NUQVRFPS92YXIvbGliL2t1YmVsZXQvY3B1X21hbmFnZXJfc3RhdGUKRlVMTF9DUFVfU1RBVEU9L3N5cy9mcy9jZ3JvdXAvY3B1c2V0L2NwdXNldC5jcHVzCktVQkVMRVRfQ09ORj0vZXRjL2t1YmVybmV0ZXMva3ViZWxldC5jb25mCnVucmVzdHJpY3RlZENwdXNldCgpIHsKICBsb2NhbCBjcHVzCiAgaWYgW1sgLWUgJEtVQkVMRVRfQ1BVX1NUQVRFIF1dOyB0aGVuCiAgICBjcHVzPSQoanEgLXIgJy5kZWZhdWx0Q3B1U2V0JyA8JEtVQkVMRVRfQ1BVX1NUQVRFKQogICAgaWYgW1sgLW4gIiR7Y3B1c30iICYmIC1lICR7S1VCRUxFVF9DT05GfSBdXTsgdGhlbgogICAgICByZXNlcnZlZF9jcHVzPSQoanEgLXIgJy5yZXNlcnZlZFN5c3RlbUNQVXMnIDwvZXRjL2t1YmVybmV0ZXMva3ViZWxldC5jb25mKQogICAgICBpZiBbWyAtbiAiJHtyZXNlcnZlZF9jcHVzfSIgXV07IHRoZW4KICAgICAgICAjIFVzZSB0YXNrc2V0IHRvIG1lcmdlIHRoZSB0d28gY3B1c2V0cwogICAgICAgIGNwdXM9JCh0YXNrc2V0IC1jICIke3Jlc2VydmVkX2NwdXN9LCR7Y3B1c30iIGdyZXAgLWkgQ3B1c19hbGxvd2VkX2xpc3QgL3Byb2Mvc2VsZi9zdGF0dXMgfCBhd2sgJ3twcmludCAkMn0nKQogICAgICBmaQogICAgZmkKICBmaQogIGlmIFtbIC16ICRjcHVzIF1dOyB0aGVuCiAgICAjIGZhbGwgYmFjayB0byB1c2luZyBhbGwgY3B1cyBpZiB0aGUga3ViZWxldCBzdGF0ZSBpcyBub3QgY29uZmlndXJlZCB5ZXQKICAgIFtbIC1lICRGVUxMX0NQVV9TVEFURSBdXSB8fCByZXR1cm4gMQogICAgY3B1cz0kKDwkRlVMTF9DUFVfU1RBVEUpCiAgZmkKICBlY2hvICRjcHVzCn0KCnJlc3RyaWN0ZWRDcHVzZXQoKSB7CiAgZm9yIGFyZyBpbiAkKDwvcHJvYy9jbWRsaW5lKTsgZG8KICAgIGlmIFtbICRhcmcgPX4gXnN5c3RlbWQuY3B1X2FmZmluaXR5PSBdXTsgdGhlbgogICAgICBlY2hvICR7YXJnIyo9fQogICAgICByZXR1cm4gMAogICAgZmkKICBkb25lCiAgcmV0dXJuIDEKfQoKcmVzZXRBZmZpbml0eSgpIHsKICBsb2NhbCBjcHVzZXQ9IiQxIgogIGxvY2FsIGZhaWxjb3VudD0wCiAgbG9jYWwgc3VjY2Vzc2NvdW50PTAKICBsb2dnZXIgIlJlY292ZXJ5OiBTZXR0aW5nIENQVSBhZmZpbml0eSBmb3IgY3JpdGljYWwgcHJvY2Vzc2VzIFwiJENSSVRJQ0FMX1BST0NFU1NFU1wiIHRvICRjcHVzZXQiCiAgZm9yIHByb2MgaW4gJENSSVRJQ0FMX1BST0NFU1NFUzsgZG8KICAgIGxvY2FsIHBpZHM9IiQocGdyZXAgJHByb2MpIgogICAgZm9yIHBpZCBpbiAkcGlkczsgZG8KICAgICAgbG9jYWwgdGFza3NldE91dHB1dAogICAgICB0YXNrc2V0T3V0cHV0PSIkKHRhc2tzZXQgLWFwYyAiJGNwdXNldCIgJHBpZCAyPiYxKSIKICAgICAgaWYgW1sgJD8gLW5lIDAgXV07IHRoZW4KICAgICAgICBlY2hvICJFUlJPUjogJHRhc2tzZXRPdXRwdXQiCiAgICAgICAgKChmYWlsY291bnQrKykpCiAgICAgIGVsc2UKICAgICAgICAoKHN1Y2Nlc3Njb3VudCsrKSkKICAgICAgZmkKICAgIGRvbmUKICBkb25lCgogIGxvZ2dlciAiUmVjb3Zlcnk6IFJlLWFmZmluZWQgJHN1Y2Nlc3Njb3VudCBwaWRzIHN1Y2Nlc3NmdWxseSIKICBpZiBbWyAkZmFpbGNvdW50IC1ndCAwIF1dOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBGYWlsZWQgdG8gcmUtYWZmaW5lICRmYWlsY291bnQgcHJvY2Vzc2VzIgogICAgcmV0dXJuIDEKICBmaQp9CgpzZXRVbnJlc3RyaWN0ZWQoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogU2V0dGluZyBjcml0aWNhbCBzeXN0ZW0gcHJvY2Vzc2VzIHRvIGhhdmUgdW5yZXN0cmljdGVkIENQVSBhY2Nlc3MiCiAgcmVzZXRBZmZpbml0eSAiJCh1bnJlc3RyaWN0ZWRDcHVzZXQpIgp9CgpzZXRSZXN0cmljdGVkKCkgewogIGxvZ2dlciAiUmVjb3Zlcnk6IFJlc2V0dGluZyBjcml0aWNhbCBzeXN0ZW0gcHJvY2Vzc2VzIGJhY2sgdG8gbm9ybWFsbHkgcmVzdHJpY3RlZCBhY2Nlc3MiCiAgcmVzZXRBZmZpbml0eSAiJChyZXN0cmljdGVkQ3B1c2V0KSIKfQoKY3VycmVudEFmZmluaXR5KCkgewogIGxvY2FsIHBpZD0iJDEiCiAgdGFza3NldCAtcGMgJHBpZCB8IGF3ayAtRic6ICcgJ3twcmludCAkMn0nCn0KCndpdGhpbigpIHsKICBsb2NhbCBsYXN0PSQxIGN1cnJlbnQ9JDIgdGhyZXNob2xkPSQzCiAgbG9jYWwgZGVsdGE9MCBwY2hhbmdlCiAgZGVsdGE9JCgoIGN1cnJlbnQgLSBsYXN0ICkpCiAgaWYgW1sgJGN1cnJlbnQgLWVxICRsYXN0IF1dOyB0aGVuCiAgICBwY2hhbmdlPTAKICBlbGlmIFtbICRsYXN0IC1lcSAwIF1dOyB0aGVuCiAgICBwY2hhbmdlPTEwMDAwMDAKICBlbHNlCiAgICBwY2hhbmdlPSQoKCAoICRkZWx0YSAqIDEwMCkgLyBsYXN0ICkpCiAgZmkKICBlY2hvIC1uICJsYXN0OiRsYXN0IGN1cnJlbnQ6JGN1cnJlbnQgZGVsdGE6JGRlbHRhIHBjaGFuZ2U6JHtwY2hhbmdlfSU6ICIKICBsb2NhbCBhYnNvbHV0ZSBsaW1pdAogIGNhc2UgJHRocmVzaG9sZCBpbgogICAgKiUpCiAgICAgIGFic29sdXRlPSR7cGNoYW5nZSMjLX0gIyBhYnNvbHV0ZSB2YWx1ZQogICAgICBsaW1pdD0ke3RocmVzaG9sZCUlJX0KICAgICAgOzsKICAgICopCiAgICAgIGFic29sdXRlPSR7ZGVsdGEjIy19ICMgYWJzb2x1dGUgdmFsdWUKICAgICAgbGltaXQ9JHRocmVzaG9sZAogICAgICA7OwogIGVzYWMKICBpZiBbWyAkYWJzb2x1dGUgLWxlICRsaW1pdCBdXTsgdGhlbgogICAgZWNobyAid2l0aGluICgrLy0pJHRocmVzaG9sZCIKICAgIHJldHVybiAwCiAgZWxzZQogICAgZWNobyAib3V0c2lkZSAoKy8tKSR0aHJlc2hvbGQiCiAgICByZXR1cm4gMQogIGZpCn0KCnN0ZWFkeXN0YXRlKCkgewogIGxvY2FsIGxhc3Q9JDEgY3VycmVudD0kMgogIGlmIFtbICRsYXN0IC1sdCAkU1RFQURZX1NUQVRFX01JTklNVU0gXV07IHRoZW4KICAgIGVjaG8gImxhc3Q6JGxhc3QgY3VycmVudDokY3VycmVudCBXYWl0aW5nIHRvIHJlYWNoICRTVEVBRFlfU1RBVEVfTUlOSU1VTSBiZWZvcmUgY2hlY2tpbmcgZm9yIHN0ZWFkeS1zdGF0ZSIKICAgIHJldHVybiAxCiAgZmkKICB3aXRoaW4gJGxhc3QgJGN1cnJlbnQgJFNURUFEWV9TVEFURV9USFJFU0hPTEQKfQoKd2FpdEZvclJlYWR5KCkgewogIGxvZ2dlciAiUmVjb3Zlcnk6IFdhaXRpbmcgJHtNQVhJTVVNX1dBSVRfVElNRX1zIGZvciB0aGUgaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGUiCiAgbG9jYWwgbGFzdFN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogIGxvY2FsIGxhc3REZXNpcmVkQ3B1c2V0PSIkKHVucmVzdHJpY3RlZENwdXNldCkiCiAgbG9jYWwgdD0wIHM9MTAKICBsb2NhbCBsYXN0Q2NvdW50PTAgY2NvdW50PTAgc3RlYWR5U3RhdGVUaW1lPTAKICB3aGlsZSBbWyAkdCAtbHQgJE1BWElNVU1fV0FJVF9USU1FIF1dOyBkbwogICAgc2xlZXAgJHMKICAgICgodCArPSBzKSkKICAgICMgUmUtY2hlY2sgdGhlIGN1cnJlbnQgYWZmaW5pdHkgb2Ygc3lzdGVtZCwgaW4gY2FzZSBzb21lIG90aGVyIHByb2Nlc3MgaGFzIGNoYW5nZWQgaXQKICAgIGxvY2FsIHN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogICAgIyBSZS1jaGVjayB0aGUgdW5yZXN0cmljdGVkIENwdXNldCwgYXMgdGhlIGFsbG93ZWQgc2V0IG9mIHVucmVzZXJ2ZWQgY29yZXMgbWF5IGNoYW5nZSBhcyBwb2RzIGFyZSBhc3NpZ25lZCB0byBjb3JlcwogICAgbG9jYWwgZGVzaXJlZENwdXNldD0iJCh1bnJlc3RyaWN0ZWRDcHVzZXQpIgogICAgaWYgW1sgJHN5c3RlbWRDcHVzZXQgIT0gJGxhc3RTeXN0ZW1kQ3B1c2V0IHx8ICRsYXN0RGVzaXJlZENwdXNldCAhPSAkZGVzaXJlZENwdXNldCBdXTsgdGhlbgogICAgICByZXNldEFmZmluaXR5ICIkZGVzaXJlZENwdXNldCIKICAgICAgbGFzdFN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogICAgICBsYXN0RGVzaXJlZENwdXNldD0iJGRlc2lyZWRDcHVzZXQiCiAgICBmaQoKICAgICMgRGV0ZWN0IHN0ZWFkeS1zdGF0ZSBwb2QgY291bnQKICAgIGNjb3VudD0kKGNyaWN0bCBwcyB8IHdjIC1sKQogICAgaWYgc3RlYWR5c3RhdGUgJGxhc3RDY291bnQgJGNjb3VudDsgdGhlbgogICAgICAoKHN0ZWFkeVN0YXRlVGltZSArPSBzKSkKICAgICAgZWNobyAiU3RlYWR5LXN0YXRlIGZvciAke3N0ZWFkeVN0YXRlVGltZX1zLyR7U1RFQURZX1NUQVRFX1dJTkRPV31zIgogICAgICBpZiBbWyAkc3RlYWR5U3RhdGVUaW1lIC1nZSAkU1RFQURZX1NUQVRFX1dJTkRPVyBdXTsgdGhlbgogICAgICAgIGxvZ2dlciAiUmVjb3Zlcnk6IFN0ZWFkeS1zdGF0ZSAoKy8tICRTVEVBRFlfU1RBVEVfVEhSRVNIT0xEKSBmb3IgJHtTVEVBRFlfU1RBVEVfV0lORE9XfXM6IERvbmUiCiAgICAgICAgcmV0dXJuIDAKICAgICAgZmkKICAgIGVsc2UKICAgICAgaWYgW1sgJHN0ZWFkeVN0YXRlVGltZSAtZ3QgMCBdXTsgdGhlbgogICAgICAgIGVjaG8gIlJlc2V0dGluZyBzdGVhZHktc3RhdGUgdGltZXIiCiAgICAgICAgc3RlYWR5U3RhdGVUaW1lPTAKICAgICAgZmkKICAgIGZpCiAgICBsYXN0Q2NvdW50PSRjY291bnQKICBkb25lCiAgbG9nZ2VyICJSZWNvdmVyeTogUmVjb3ZlcnkgQ29tcGxldGUgVGltZW91dCIKfQoKbWFpbigpIHsKICBpZiAhIHVucmVzdHJpY3RlZENwdXNldCA+Ji9kZXYvbnVsbDsgdGhlbgogICAgbG9nZ2VyICJSZWNvdmVyeTogTm8gdW5yZXN0cmljdGVkIENwdXNldCBjb3VsZCBiZSBkZXRlY3RlZCIKICAgIHJldHVybiAxCiAgZmkKCiAgaWYgISByZXN0cmljdGVkQ3B1c2V0ID4mL2Rldi9udWxsOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBObyByZXN0cmljdGVkIENwdXNldCBoYXMgYmVlbiBjb25maWd1cmVkLiAgV2UgYXJlIGFscmVhZHkgcnVubmluZyB1bnJlc3RyaWN0ZWQuIgogICAgcmV0dXJuIDAKICBmaQoKICAjIEVuc3VyZSB3ZSByZXNldCB0aGUgQ1BVIGFmZmluaXR5IHdoZW4gd2UgZXhpdCB0aGlzIHNjcmlwdCBmb3IgYW55IHJlYXNvbgogICMgVGhpcyB3YXkgZWl0aGVyIGFmdGVyIHRoZSB0aW1lciBleHBpcmVzIG9yIGFmdGVyIHRoZSBwcm9jZXNzIGlzIGludGVycnVwdGVkCiAgIyB2aWEgXkMgb3IgU0lHVEVSTSwgd2UgcmV0dXJuIHRoaW5ncyBiYWNrIHRvIHRoZSB3YXkgdGhleSBzaG91bGQgYmUuCiAgdHJhcCBzZXRSZXN0cmljdGVkIEVYSVQKCiAgbG9nZ2VyICJSZWNvdmVyeTogUmVjb3ZlcnkgTW9kZSBTdGFydGluZyIKICBzZXRVbnJlc3RyaWN0ZWQKICB3YWl0Rm9yUmVhZHkKfQoKaWYgW1sgIiR7QkFTSF9TT1VSQ0VbMF19IiA9ICIkezB9IiBdXTsgdGhlbgogIG1haW4gIiR7QH0iCiAgZXhpdCAkPwpmaQo=
                mode: 493
                path: /usr/local/bin/accelerated-container-startup.sh
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container startup

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold = 2%
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=2%%

                  # Steady-state window = 120s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=120

                  # Steady-state minimum = 40
                  # Increasing this will skip any steady-state checks until the count rises above
                  # this number to avoid false positives if there are some periods where the
                  # count doesn't increase but we know we can't be at steady-state yet.
                  Environment=STEADY_STATE_MINIMUM=40

                  [Install]
                  WantedBy=multi-user.target
                enabled: true
                name: accelerated-container-startup.service
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container shutdown
                  DefaultDependencies=no

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=-1

                  # Steady-state window = 60s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=60

                  [Install]
                  WantedBy=shutdown.target reboot.target halt.target
                enabled: true
                name: accelerated-container-shutdown.service
    04-accelerated-container-startup-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: 04-accelerated-container-startup-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIwojIFRlbXBvcmFyaWx5IHJlc2V0IHRoZSBjb3JlIHN5c3RlbSBwcm9jZXNzZXMncyBDUFUgYWZmaW5pdHkgdG8gYmUgdW5yZXN0cmljdGVkIHRvIGFjY2VsZXJhdGUgc3RhcnR1cCBhbmQgc2h1dGRvd24KIwojIFRoZSBkZWZhdWx0cyBiZWxvdyBjYW4gYmUgb3ZlcnJpZGRlbiB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzCiMKCiMgVGhlIGRlZmF1bHQgc2V0IG9mIGNyaXRpY2FsIHByb2Nlc3NlcyB3aG9zZSBhZmZpbml0eSBzaG91bGQgYmUgdGVtcG9yYXJpbHkgdW5ib3VuZDoKQ1JJVElDQUxfUFJPQ0VTU0VTPSR7Q1JJVElDQUxfUFJPQ0VTU0VTOi0ic3lzdGVtZCBjcmlvIGt1YmVsZXQgTmV0d29ya01hbmFnZXIgY29ubW9uIGRidXMifQoKIyBEZWZhdWx0IHdhaXQgdGltZSBpcyA2MDBzID0gMTBtOgpNQVhJTVVNX1dBSVRfVElNRT0ke01BWElNVU1fV0FJVF9USU1FOi02MDB9CgojIERlZmF1bHQgc3RlYWR5LXN0YXRlIHRocmVzaG9sZCA9IDIlCiMgQWxsb3dlZCB2YWx1ZXM6CiMgIDQgIC0gYWJzb2x1dGUgcG9kIGNvdW50ICgrLy0pCiMgIDQlIC0gcGVyY2VudCBjaGFuZ2UgKCsvLSkKIyAgLTEgLSBkaXNhYmxlIHRoZSBzdGVhZHktc3RhdGUgY2hlY2sKU1RFQURZX1NUQVRFX1RIUkVTSE9MRD0ke1NURUFEWV9TVEFURV9USFJFU0hPTEQ6LTIlfQoKIyBEZWZhdWx0IHN0ZWFkeS1zdGF0ZSB3aW5kb3cgPSA2MHMKIyBJZiB0aGUgcnVubmluZyBwb2QgY291bnQgc3RheXMgd2l0aGluIHRoZSBnaXZlbiB0aHJlc2hvbGQgZm9yIHRoaXMgdGltZQojIHBlcmlvZCwgcmV0dXJuIENQVSB1dGlsaXphdGlvbiB0byBub3JtYWwgYmVmb3JlIHRoZSBtYXhpbXVtIHdhaXQgdGltZSBoYXMKIyBleHBpcmVzClNURUFEWV9TVEFURV9XSU5ET1c9JHtTVEVBRFlfU1RBVEVfV0lORE9XOi02MH0KCiMgRGVmYXVsdCBzdGVhZHktc3RhdGUgYWxsb3dzIGFueSBwb2QgY291bnQgdG8gYmUgInN0ZWFkeSBzdGF0ZSIKIyBJbmNyZWFzaW5nIHRoaXMgd2lsbCBza2lwIGFueSBzdGVhZHktc3RhdGUgY2hlY2tzIHVudGlsIHRoZSBjb3VudCByaXNlcyBhYm92ZQojIHRoaXMgbnVtYmVyIHRvIGF2b2lkIGZhbHNlIHBvc2l0aXZlcyBpZiB0aGVyZSBhcmUgc29tZSBwZXJpb2RzIHdoZXJlIHRoZQojIGNvdW50IGRvZXNuJ3QgaW5jcmVhc2UgYnV0IHdlIGtub3cgd2UgY2FuJ3QgYmUgYXQgc3RlYWR5LXN0YXRlIHlldC4KU1RFQURZX1NUQVRFX01JTklNVU09JHtTVEVBRFlfU1RBVEVfTUlOSU1VTTotMH0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCktVQkVMRVRfQ1BVX1NUQVRFPS92YXIvbGliL2t1YmVsZXQvY3B1X21hbmFnZXJfc3RhdGUKRlVMTF9DUFVfU1RBVEU9L3N5cy9mcy9jZ3JvdXAvY3B1c2V0L2NwdXNldC5jcHVzCktVQkVMRVRfQ09ORj0vZXRjL2t1YmVybmV0ZXMva3ViZWxldC5jb25mCnVucmVzdHJpY3RlZENwdXNldCgpIHsKICBsb2NhbCBjcHVzCiAgaWYgW1sgLWUgJEtVQkVMRVRfQ1BVX1NUQVRFIF1dOyB0aGVuCiAgICBjcHVzPSQoanEgLXIgJy5kZWZhdWx0Q3B1U2V0JyA8JEtVQkVMRVRfQ1BVX1NUQVRFKQogICAgaWYgW1sgLW4gIiR7Y3B1c30iICYmIC1lICR7S1VCRUxFVF9DT05GfSBdXTsgdGhlbgogICAgICByZXNlcnZlZF9jcHVzPSQoanEgLXIgJy5yZXNlcnZlZFN5c3RlbUNQVXMnIDwvZXRjL2t1YmVybmV0ZXMva3ViZWxldC5jb25mKQogICAgICBpZiBbWyAtbiAiJHtyZXNlcnZlZF9jcHVzfSIgXV07IHRoZW4KICAgICAgICAjIFVzZSB0YXNrc2V0IHRvIG1lcmdlIHRoZSB0d28gY3B1c2V0cwogICAgICAgIGNwdXM9JCh0YXNrc2V0IC1jICIke3Jlc2VydmVkX2NwdXN9LCR7Y3B1c30iIGdyZXAgLWkgQ3B1c19hbGxvd2VkX2xpc3QgL3Byb2Mvc2VsZi9zdGF0dXMgfCBhd2sgJ3twcmludCAkMn0nKQogICAgICBmaQogICAgZmkKICBmaQogIGlmIFtbIC16ICRjcHVzIF1dOyB0aGVuCiAgICAjIGZhbGwgYmFjayB0byB1c2luZyBhbGwgY3B1cyBpZiB0aGUga3ViZWxldCBzdGF0ZSBpcyBub3QgY29uZmlndXJlZCB5ZXQKICAgIFtbIC1lICRGVUxMX0NQVV9TVEFURSBdXSB8fCByZXR1cm4gMQogICAgY3B1cz0kKDwkRlVMTF9DUFVfU1RBVEUpCiAgZmkKICBlY2hvICRjcHVzCn0KCnJlc3RyaWN0ZWRDcHVzZXQoKSB7CiAgZm9yIGFyZyBpbiAkKDwvcHJvYy9jbWRsaW5lKTsgZG8KICAgIGlmIFtbICRhcmcgPX4gXnN5c3RlbWQuY3B1X2FmZmluaXR5PSBdXTsgdGhlbgogICAgICBlY2hvICR7YXJnIyo9fQogICAgICByZXR1cm4gMAogICAgZmkKICBkb25lCiAgcmV0dXJuIDEKfQoKcmVzZXRBZmZpbml0eSgpIHsKICBsb2NhbCBjcHVzZXQ9IiQxIgogIGxvY2FsIGZhaWxjb3VudD0wCiAgbG9jYWwgc3VjY2Vzc2NvdW50PTAKICBsb2dnZXIgIlJlY292ZXJ5OiBTZXR0aW5nIENQVSBhZmZpbml0eSBmb3IgY3JpdGljYWwgcHJvY2Vzc2VzIFwiJENSSVRJQ0FMX1BST0NFU1NFU1wiIHRvICRjcHVzZXQiCiAgZm9yIHByb2MgaW4gJENSSVRJQ0FMX1BST0NFU1NFUzsgZG8KICAgIGxvY2FsIHBpZHM9IiQocGdyZXAgJHByb2MpIgogICAgZm9yIHBpZCBpbiAkcGlkczsgZG8KICAgICAgbG9jYWwgdGFza3NldE91dHB1dAogICAgICB0YXNrc2V0T3V0cHV0PSIkKHRhc2tzZXQgLWFwYyAiJGNwdXNldCIgJHBpZCAyPiYxKSIKICAgICAgaWYgW1sgJD8gLW5lIDAgXV07IHRoZW4KICAgICAgICBlY2hvICJFUlJPUjogJHRhc2tzZXRPdXRwdXQiCiAgICAgICAgKChmYWlsY291bnQrKykpCiAgICAgIGVsc2UKICAgICAgICAoKHN1Y2Nlc3Njb3VudCsrKSkKICAgICAgZmkKICAgIGRvbmUKICBkb25lCgogIGxvZ2dlciAiUmVjb3Zlcnk6IFJlLWFmZmluZWQgJHN1Y2Nlc3Njb3VudCBwaWRzIHN1Y2Nlc3NmdWxseSIKICBpZiBbWyAkZmFpbGNvdW50IC1ndCAwIF1dOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBGYWlsZWQgdG8gcmUtYWZmaW5lICRmYWlsY291bnQgcHJvY2Vzc2VzIgogICAgcmV0dXJuIDEKICBmaQp9CgpzZXRVbnJlc3RyaWN0ZWQoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogU2V0dGluZyBjcml0aWNhbCBzeXN0ZW0gcHJvY2Vzc2VzIHRvIGhhdmUgdW5yZXN0cmljdGVkIENQVSBhY2Nlc3MiCiAgcmVzZXRBZmZpbml0eSAiJCh1bnJlc3RyaWN0ZWRDcHVzZXQpIgp9CgpzZXRSZXN0cmljdGVkKCkgewogIGxvZ2dlciAiUmVjb3Zlcnk6IFJlc2V0dGluZyBjcml0aWNhbCBzeXN0ZW0gcHJvY2Vzc2VzIGJhY2sgdG8gbm9ybWFsbHkgcmVzdHJpY3RlZCBhY2Nlc3MiCiAgcmVzZXRBZmZpbml0eSAiJChyZXN0cmljdGVkQ3B1c2V0KSIKfQoKY3VycmVudEFmZmluaXR5KCkgewogIGxvY2FsIHBpZD0iJDEiCiAgdGFza3NldCAtcGMgJHBpZCB8IGF3ayAtRic6ICcgJ3twcmludCAkMn0nCn0KCndpdGhpbigpIHsKICBsb2NhbCBsYXN0PSQxIGN1cnJlbnQ9JDIgdGhyZXNob2xkPSQzCiAgbG9jYWwgZGVsdGE9MCBwY2hhbmdlCiAgZGVsdGE9JCgoIGN1cnJlbnQgLSBsYXN0ICkpCiAgaWYgW1sgJGN1cnJlbnQgLWVxICRsYXN0IF1dOyB0aGVuCiAgICBwY2hhbmdlPTAKICBlbGlmIFtbICRsYXN0IC1lcSAwIF1dOyB0aGVuCiAgICBwY2hhbmdlPTEwMDAwMDAKICBlbHNlCiAgICBwY2hhbmdlPSQoKCAoICRkZWx0YSAqIDEwMCkgLyBsYXN0ICkpCiAgZmkKICBlY2hvIC1uICJsYXN0OiRsYXN0IGN1cnJlbnQ6JGN1cnJlbnQgZGVsdGE6JGRlbHRhIHBjaGFuZ2U6JHtwY2hhbmdlfSU6ICIKICBsb2NhbCBhYnNvbHV0ZSBsaW1pdAogIGNhc2UgJHRocmVzaG9sZCBpbgogICAgKiUpCiAgICAgIGFic29sdXRlPSR7cGNoYW5nZSMjLX0gIyBhYnNvbHV0ZSB2YWx1ZQogICAgICBsaW1pdD0ke3RocmVzaG9sZCUlJX0KICAgICAgOzsKICAgICopCiAgICAgIGFic29sdXRlPSR7ZGVsdGEjIy19ICMgYWJzb2x1dGUgdmFsdWUKICAgICAgbGltaXQ9JHRocmVzaG9sZAogICAgICA7OwogIGVzYWMKICBpZiBbWyAkYWJzb2x1dGUgLWxlICRsaW1pdCBdXTsgdGhlbgogICAgZWNobyAid2l0aGluICgrLy0pJHRocmVzaG9sZCIKICAgIHJldHVybiAwCiAgZWxzZQogICAgZWNobyAib3V0c2lkZSAoKy8tKSR0aHJlc2hvbGQiCiAgICByZXR1cm4gMQogIGZpCn0KCnN0ZWFkeXN0YXRlKCkgewogIGxvY2FsIGxhc3Q9JDEgY3VycmVudD0kMgogIGlmIFtbICRsYXN0IC1sdCAkU1RFQURZX1NUQVRFX01JTklNVU0gXV07IHRoZW4KICAgIGVjaG8gImxhc3Q6JGxhc3QgY3VycmVudDokY3VycmVudCBXYWl0aW5nIHRvIHJlYWNoICRTVEVBRFlfU1RBVEVfTUlOSU1VTSBiZWZvcmUgY2hlY2tpbmcgZm9yIHN0ZWFkeS1zdGF0ZSIKICAgIHJldHVybiAxCiAgZmkKICB3aXRoaW4gJGxhc3QgJGN1cnJlbnQgJFNURUFEWV9TVEFURV9USFJFU0hPTEQKfQoKd2FpdEZvclJlYWR5KCkgewogIGxvZ2dlciAiUmVjb3Zlcnk6IFdhaXRpbmcgJHtNQVhJTVVNX1dBSVRfVElNRX1zIGZvciB0aGUgaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGUiCiAgbG9jYWwgbGFzdFN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogIGxvY2FsIGxhc3REZXNpcmVkQ3B1c2V0PSIkKHVucmVzdHJpY3RlZENwdXNldCkiCiAgbG9jYWwgdD0wIHM9MTAKICBsb2NhbCBsYXN0Q2NvdW50PTAgY2NvdW50PTAgc3RlYWR5U3RhdGVUaW1lPTAKICB3aGlsZSBbWyAkdCAtbHQgJE1BWElNVU1fV0FJVF9USU1FIF1dOyBkbwogICAgc2xlZXAgJHMKICAgICgodCArPSBzKSkKICAgICMgUmUtY2hlY2sgdGhlIGN1cnJlbnQgYWZmaW5pdHkgb2Ygc3lzdGVtZCwgaW4gY2FzZSBzb21lIG90aGVyIHByb2Nlc3MgaGFzIGNoYW5nZWQgaXQKICAgIGxvY2FsIHN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogICAgIyBSZS1jaGVjayB0aGUgdW5yZXN0cmljdGVkIENwdXNldCwgYXMgdGhlIGFsbG93ZWQgc2V0IG9mIHVucmVzZXJ2ZWQgY29yZXMgbWF5IGNoYW5nZSBhcyBwb2RzIGFyZSBhc3NpZ25lZCB0byBjb3JlcwogICAgbG9jYWwgZGVzaXJlZENwdXNldD0iJCh1bnJlc3RyaWN0ZWRDcHVzZXQpIgogICAgaWYgW1sgJHN5c3RlbWRDcHVzZXQgIT0gJGxhc3RTeXN0ZW1kQ3B1c2V0IHx8ICRsYXN0RGVzaXJlZENwdXNldCAhPSAkZGVzaXJlZENwdXNldCBdXTsgdGhlbgogICAgICByZXNldEFmZmluaXR5ICIkZGVzaXJlZENwdXNldCIKICAgICAgbGFzdFN5c3RlbWRDcHVzZXQ9IiQoY3VycmVudEFmZmluaXR5IDEpIgogICAgICBsYXN0RGVzaXJlZENwdXNldD0iJGRlc2lyZWRDcHVzZXQiCiAgICBmaQoKICAgICMgRGV0ZWN0IHN0ZWFkeS1zdGF0ZSBwb2QgY291bnQKICAgIGNjb3VudD0kKGNyaWN0bCBwcyB8IHdjIC1sKQogICAgaWYgc3RlYWR5c3RhdGUgJGxhc3RDY291bnQgJGNjb3VudDsgdGhlbgogICAgICAoKHN0ZWFkeVN0YXRlVGltZSArPSBzKSkKICAgICAgZWNobyAiU3RlYWR5LXN0YXRlIGZvciAke3N0ZWFkeVN0YXRlVGltZX1zLyR7U1RFQURZX1NUQVRFX1dJTkRPV31zIgogICAgICBpZiBbWyAkc3RlYWR5U3RhdGVUaW1lIC1nZSAkU1RFQURZX1NUQVRFX1dJTkRPVyBdXTsgdGhlbgogICAgICAgIGxvZ2dlciAiUmVjb3Zlcnk6IFN0ZWFkeS1zdGF0ZSAoKy8tICRTVEVBRFlfU1RBVEVfVEhSRVNIT0xEKSBmb3IgJHtTVEVBRFlfU1RBVEVfV0lORE9XfXM6IERvbmUiCiAgICAgICAgcmV0dXJuIDAKICAgICAgZmkKICAgIGVsc2UKICAgICAgaWYgW1sgJHN0ZWFkeVN0YXRlVGltZSAtZ3QgMCBdXTsgdGhlbgogICAgICAgIGVjaG8gIlJlc2V0dGluZyBzdGVhZHktc3RhdGUgdGltZXIiCiAgICAgICAgc3RlYWR5U3RhdGVUaW1lPTAKICAgICAgZmkKICAgIGZpCiAgICBsYXN0Q2NvdW50PSRjY291bnQKICBkb25lCiAgbG9nZ2VyICJSZWNvdmVyeTogUmVjb3ZlcnkgQ29tcGxldGUgVGltZW91dCIKfQoKbWFpbigpIHsKICBpZiAhIHVucmVzdHJpY3RlZENwdXNldCA+Ji9kZXYvbnVsbDsgdGhlbgogICAgbG9nZ2VyICJSZWNvdmVyeTogTm8gdW5yZXN0cmljdGVkIENwdXNldCBjb3VsZCBiZSBkZXRlY3RlZCIKICAgIHJldHVybiAxCiAgZmkKCiAgaWYgISByZXN0cmljdGVkQ3B1c2V0ID4mL2Rldi9udWxsOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBObyByZXN0cmljdGVkIENwdXNldCBoYXMgYmVlbiBjb25maWd1cmVkLiAgV2UgYXJlIGFscmVhZHkgcnVubmluZyB1bnJlc3RyaWN0ZWQuIgogICAgcmV0dXJuIDAKICBmaQoKICAjIEVuc3VyZSB3ZSByZXNldCB0aGUgQ1BVIGFmZmluaXR5IHdoZW4gd2UgZXhpdCB0aGlzIHNjcmlwdCBmb3IgYW55IHJlYXNvbgogICMgVGhpcyB3YXkgZWl0aGVyIGFmdGVyIHRoZSB0aW1lciBleHBpcmVzIG9yIGFmdGVyIHRoZSBwcm9jZXNzIGlzIGludGVycnVwdGVkCiAgIyB2aWEgXkMgb3IgU0lHVEVSTSwgd2UgcmV0dXJuIHRoaW5ncyBiYWNrIHRvIHRoZSB3YXkgdGhleSBzaG91bGQgYmUuCiAgdHJhcCBzZXRSZXN0cmljdGVkIEVYSVQKCiAgbG9nZ2VyICJSZWNvdmVyeTogUmVjb3ZlcnkgTW9kZSBTdGFydGluZyIKICBzZXRVbnJlc3RyaWN0ZWQKICB3YWl0Rm9yUmVhZHkKfQoKaWYgW1sgIiR7QkFTSF9TT1VSQ0VbMF19IiA9ICIkezB9IiBdXTsgdGhlbgogIG1haW4gIiR7QH0iCiAgZXhpdCAkPwpmaQo=
                mode: 493
                path: /usr/local/bin/accelerated-container-startup.sh
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container startup

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold = 2%
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=2%%

                  # Steady-state window = 120s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=120

                  # Steady-state minimum = 40
                  # Increasing this will skip any steady-state checks until the count rises above
                  # this number to avoid false positives if there are some periods where the
                  # count doesn't increase but we know we can't be at steady-state yet.
                  Environment=STEADY_STATE_MINIMUM=40

                  [Install]
                  WantedBy=multi-user.target
                enabled: true
                name: accelerated-container-startup.service
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container shutdown
                  DefaultDependencies=no

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=-1

                  # Steady-state window = 60s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=60

                  [Install]
                  WantedBy=shutdown.target reboot.target halt.target
                enabled: true
                name: accelerated-container-shutdown.service
    06-kdump-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: 06-kdump-enable-master
        spec:
          config:
            ignition:
              version: 3.2.0
            systemd:
              units:
              - enabled: true
                name: kdump.service
          kernelArguments:
            - crashkernel=512M
    06-kdump-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: 06-kdump-enable-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            systemd:
              units:
              - enabled: true
                name: kdump.service
          kernelArguments:
            - crashkernel=512M
kind: ConfigMap
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
---
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "2"
    name: cluster1
spec:
    hubAcceptsClient: true
---
apiVersion: agent.open-cluster-management.io/v1
kind: KlusterletAddonConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "2"
    name: cluster1
    namespace: cluster1
spec:
    applicationManager:
        enabled: false
    certPolicyController:
        enabled: false
    clusterLabels:
        cloud: auto-detect
        vendor: auto-detect
    clusterName: cluster1
    clusterNamespace: cluster1
    iamPolicyController:
        enabled: false
    policyController:
        enabled: true
    searchCollector:
        enabled: false
