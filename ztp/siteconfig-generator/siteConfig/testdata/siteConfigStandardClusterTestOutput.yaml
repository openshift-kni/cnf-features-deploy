---
apiVersion: v1
kind: Namespace
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "0"
    labels:
        name: cluster1
    name: cluster1
---
apiVersion: extensions.hive.openshift.io/v1beta1
kind: AgentClusterInstall
metadata:
    annotations:
        agent-install.openshift.io/install-config-overrides: '{"networking":{"networkType":"OVNKubernetes"}}'
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    clusterDeploymentRef:
        name: cluster1
    imageSetRef:
        name: openshift-v4.9.0
    manifestsConfigMapRef:
        name: cluster1
    networking:
        clusterNetwork:
            - cidr: 10.128.0.0/14
              hostPrefix: 23
        machineNetwork:
            - cidr: 10.16.231.0/24
        serviceNetwork:
            - 172.30.0.0/16
    provisionRequirements:
        controlPlaneAgents: 3
    sshPublicKey: 'ssh-rsa '
---
apiVersion: hive.openshift.io/v1
kind: ClusterDeployment
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    baseDomain: example.com
    clusterInstallRef:
        group: extensions.hive.openshift.io
        kind: AgentClusterInstall
        name: cluster1
        version: v1beta1
    clusterName: cluster1
    platform:
        agentBareMetal:
            agentSelector:
                matchLabels:
                    cluster-name: cluster1
    pullSecretRef:
        name: pullSecretName
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node1
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:30"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node2
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:40"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    labels:
        nmstate-label: cluster1
    name: node3
    namespace: cluster1
spec:
    interfaces:
        - name: eno1
          macAddress: "00:00:00:01:20:50"
---
apiVersion: agent-install.openshift.io/v1beta1
kind: InfraEnv
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
spec:
    clusterRef:
        name: cluster1
        namespace: cluster1
    nmStateConfigLabelSelector:
        matchLabels:
            nmstate-label: cluster1
    pullSecretRef:
        name: pullSecretName
    sshAuthorizedKey: 'ssh-rsa '
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node1
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node1
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node2
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node2
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
        bmac.agent-install.openshift.io/hostname: node3
        bmac.agent-install.openshift.io/role: master
        inspect.metal3.io: disabled
    labels:
        infraenvs.agent-install.openshift.io: cluster1
    name: node3
    namespace: cluster1
spec:
    automatedCleaningMode: disabled
    bmc:
        disableCertificateVerification: true
    bootMode: UEFI
    online: true
---
apiVersion: v1
data:
    01-container-mount-ns-and-kubelet-conf-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: container-mount-namespace-and-kubelet-conf-master
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
                mode: 493
                path: /usr/local/bin/extractExecStart
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
                mode: 493
                path: /usr/local/bin/nsenterCmns
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

                  [Service]
                  Type=oneshot
                  RemainAfterExit=yes
                  RuntimeDirectory=container-mount-namespace
                  Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
                  Environment=BIND_POINT=%t/container-mount-namespace/mnt
                  ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
                  ExecStartPre=touch ${BIND_POINT}
                  ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
                  ExecStop=umount -R ${RUNTIME_DIRECTORY}
                enabled: true
                name: container-mount-namespace.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART}"
                  name: 90-container-mount-namespace.conf
                name: crio.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART} --housekeeping-interval=30s"
                  name: 90-container-mount-namespace.conf
                - contents: |
                    [Service]
                    Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                    Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
                  name: 30-kubelet-interval-tuning.conf
                name: kubelet.service
    01-container-mount-ns-and-kubelet-conf-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: container-mount-namespace-and-kubelet-conf-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
                mode: 493
                path: /usr/local/bin/extractExecStart
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
                mode: 493
                path: /usr/local/bin/nsenterCmns
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

                  [Service]
                  Type=oneshot
                  RemainAfterExit=yes
                  RuntimeDirectory=container-mount-namespace
                  Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
                  Environment=BIND_POINT=%t/container-mount-namespace/mnt
                  ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
                  ExecStartPre=touch ${BIND_POINT}
                  ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
                  ExecStop=umount -R ${RUNTIME_DIRECTORY}
                enabled: true
                name: container-mount-namespace.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART}"
                  name: 90-container-mount-namespace.conf
                name: crio.service
              - dropins:
                - contents: |
                    [Unit]
                    Wants=container-mount-namespace.service
                    After=container-mount-namespace.service

                    [Service]
                    ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                    EnvironmentFile=-/%t/%N-execstart.env
                    ExecStart=
                    ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                        ${ORIG_EXECSTART} --housekeeping-interval=30s"
                  name: 90-container-mount-namespace.conf
                - contents: |
                    [Service]
                    Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                    Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
                  name: 30-kubelet-interval-tuning.conf
                name: kubelet.service
    03-sctp-machine-config-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: load-sctp-module-master
        spec:
          config:
            ignition:
              version: 2.2.0
            storage:
              files:
                - contents:
                    source: data:,
                    verification: {}
                  filesystem: root
                  mode: 420
                  path: /etc/modprobe.d/sctp-blacklist.conf
                - contents:
                    source: data:text/plain;charset=utf-8,sctp
                  filesystem: root
                  mode: 420
                  path: /etc/modules-load.d/sctp-load.conf
    03-sctp-machine-config-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: load-sctp-module-worker
        spec:
          config:
            ignition:
              version: 2.2.0
            storage:
              files:
                - contents:
                    source: data:,
                    verification: {}
                  filesystem: root
                  mode: 420
                  path: /etc/modprobe.d/sctp-blacklist.conf
                - contents:
                    source: data:text/plain;charset=utf-8,sctp
                  filesystem: root
                  mode: 420
                  path: /etc/modules-load.d/sctp-load.conf
    04-accelerated-container-startup-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: 04-accelerated-container-startup-master
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIwojIFRlbXBvcmFyaWx5IHJlc2V0IHRoZSBjb3JlIHN5c3RlbSBwcm9jZXNzZXMncyBDUFUgYWZmaW5pdHkgdG8gYmUgdW5yZXN0cmljdGVkIHRvIGFjY2VsZXJhdGUgc3RhcnR1cCBhbmQgc2h1dGRvd24KIwojIFRoZSBkZWZhdWx0cyBiZWxvdyBjYW4gYmUgb3ZlcnJpZGRlbiB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzCiMKCiMgVGhlIGRlZmF1bHQgc2V0IG9mIGNyaXRpY2FsIHByb2Nlc3NlcyB3aG9zZSBhZmZpbml0eSBzaG91bGQgYmUgdGVtcG9yYXJpbHkgdW5ib3VuZDoKQ1JJVElDQUxfUFJPQ0VTU0VTPSR7Q1JJVElDQUxfUFJPQ0VTU0VTOi0ic3lzdGVtZCBvdnMgY3JpbyBrdWJlbGV0IE5ldHdvcmtNYW5hZ2VyIGNvbm1vbiBkYnVzIn0KCiMgRGVmYXVsdCB3YWl0IHRpbWUgaXMgNjAwcyA9IDEwbToKTUFYSU1VTV9XQUlUX1RJTUU9JHtNQVhJTVVNX1dBSVRfVElNRTotNjAwfQoKIyBEZWZhdWx0IHN0ZWFkeS1zdGF0ZSB0aHJlc2hvbGQgPSAyJQojIEFsbG93ZWQgdmFsdWVzOgojICA0ICAtIGFic29sdXRlIHBvZCBjb3VudCAoKy8tKQojICA0JSAtIHBlcmNlbnQgY2hhbmdlICgrLy0pCiMgIC0xIC0gZGlzYWJsZSB0aGUgc3RlYWR5LXN0YXRlIGNoZWNrClNURUFEWV9TVEFURV9USFJFU0hPTEQ9JHtTVEVBRFlfU1RBVEVfVEhSRVNIT0xEOi0yJX0KCiMgRGVmYXVsdCBzdGVhZHktc3RhdGUgd2luZG93ID0gNjBzCiMgSWYgdGhlIHJ1bm5pbmcgcG9kIGNvdW50IHN0YXlzIHdpdGhpbiB0aGUgZ2l2ZW4gdGhyZXNob2xkIGZvciB0aGlzIHRpbWUKIyBwZXJpb2QsIHJldHVybiBDUFUgdXRpbGl6YXRpb24gdG8gbm9ybWFsIGJlZm9yZSB0aGUgbWF4aW11bSB3YWl0IHRpbWUgaGFzCiMgZXhwaXJlcwpTVEVBRFlfU1RBVEVfV0lORE9XPSR7U1RFQURZX1NUQVRFX1dJTkRPVzotNjB9CgojIERlZmF1bHQgc3RlYWR5LXN0YXRlIGFsbG93cyBhbnkgcG9kIGNvdW50IHRvIGJlICJzdGVhZHkgc3RhdGUiCiMgSW5jcmVhc2luZyB0aGlzIHdpbGwgc2tpcCBhbnkgc3RlYWR5LXN0YXRlIGNoZWNrcyB1bnRpbCB0aGUgY291bnQgcmlzZXMgYWJvdmUKIyB0aGlzIG51bWJlciB0byBhdm9pZCBmYWxzZSBwb3NpdGl2ZXMgaWYgdGhlcmUgYXJlIHNvbWUgcGVyaW9kcyB3aGVyZSB0aGUKIyBjb3VudCBkb2Vzbid0IGluY3JlYXNlIGJ1dCB3ZSBrbm93IHdlIGNhbid0IGJlIGF0IHN0ZWFkeS1zdGF0ZSB5ZXQuClNURUFEWV9TVEFURV9NSU5JTVVNPSR7U1RFQURZX1NUQVRFX01JTklNVU06LTB9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpLVUJFTEVUX0NQVV9TVEFURT0vdmFyL2xpYi9rdWJlbGV0L2NwdV9tYW5hZ2VyX3N0YXRlCkZVTExfQ1BVX1NUQVRFPS9zeXMvZnMvY2dyb3VwL2NwdXNldC9jcHVzZXQuY3B1cwp1bnJlc3RyaWN0ZWRDcHVzZXQoKSB7CiAgbG9jYWwgY3B1cwogIGlmIFtbIC1lICRLVUJFTEVUX0NQVV9TVEFURSBdXTsgdGhlbgogICAgICBjcHVzPSQoanEgLXIgJy5kZWZhdWx0Q3B1U2V0JyA8JEtVQkVMRVRfQ1BVX1NUQVRFKQogIGZpCiAgaWYgW1sgLXogJGNwdXMgXV07IHRoZW4KICAgICMgZmFsbCBiYWNrIHRvIHVzaW5nIGFsbCBjcHVzIGlmIHRoZSBrdWJlbGV0IHN0YXRlIGlzIG5vdCBjb25maWd1cmVkIHlldAogICAgW1sgLWUgJEZVTExfQ1BVX1NUQVRFIF1dIHx8IHJldHVybiAxCiAgICBjcHVzPSQoPCRGVUxMX0NQVV9TVEFURSkKICBmaQogIGVjaG8gJGNwdXMKfQoKcmVzdHJpY3RlZENwdXNldCgpIHsKICBmb3IgYXJnIGluICQoPC9wcm9jL2NtZGxpbmUpOyBkbwogICAgaWYgW1sgJGFyZyA9fiBec3lzdGVtZC5jcHVfYWZmaW5pdHk9IF1dOyB0aGVuCiAgICAgIGVjaG8gJHthcmcjKj19CiAgICAgIHJldHVybiAwCiAgICBmaQogIGRvbmUKICByZXR1cm4gMQp9CgpnZXRDUFVDb3VudCAoKSB7CiAgbG9jYWwgY3B1c2V0PSIkMSIKICBsb2NhbCBjcHVsaXN0PSgpCiAgbG9jYWwgY3B1cz0wCiAgbG9jYWwgbWluY3B1cz0yCgogIGlmIFtbIC16ICRjcHVzZXQgfHwgJGNwdXNldCA9fiBbXjAtOSwtXSBdXTsgdGhlbgogICAgZWNobyAkbWluY3B1cwogICAgcmV0dXJuIDEKICBmaQoKICBJRlM9JywnIHJlYWQgLXJhIGNwdWxpc3QgPDw8ICRjcHVzZXQKCiAgZm9yIGVsbSBpbiAiJHtjcHVsaXN0W0BdfSI7IGRvCiAgICBpZiBbWyAkZWxtID1+IF5bMC05XSskIF1dOyB0aGVuCiAgICAgICgoIGNwdXMrKyApKQogICAgZWxpZiBbWyAkZWxtID1+IF5bMC05XSstWzAtOV0rJCBdXTsgdGhlbgogICAgICBsb2NhbCBsb3c9MCBoaWdoPTAKICAgICAgSUZTPSctJyByZWFkIGxvdyBoaWdoIDw8PCAkZWxtCiAgICAgICgoIGNwdXMgKz0gaGlnaCAtIGxvdyArIDEgKSkKICAgIGVsc2UKICAgICAgZWNobyAkbWluY3B1cwogICAgICByZXR1cm4gMQogICAgZmkKICBkb25lCgogICMgUmV0dXJuIGEgbWluaW11bSBvZiAyIGNwdXMKICBlY2hvICQoKCBjcHVzID4gJG1pbmNwdXMgPyBjcHVzIDogJG1pbmNwdXMgKSkKICByZXR1cm4gMAp9CgpyZXNldE9WU3RocmVhZHMgKCkgewogIGxvY2FsIGNwdWNvdW50PSIkMSIKICBsb2NhbCBjdXJSZXZhbGlkYXRvcnM9MAogIGxvY2FsIGN1ckhhbmRsZXJzPTAKICBsb2NhbCBkZXNpcmVkUmV2YWxpZGF0b3JzPTAKICBsb2NhbCBkZXNpcmVkSGFuZGxlcnM9MAogIGxvY2FsIHJjPTAKCiAgY3VyUmV2YWxpZGF0b3JzPSQocHMgLVRlbyBwaWQsdGlkLGNvbW0sY21kIHwgZ3JlcCAtZSByZXZhbGlkYXRvciB8IGdyZXAgLWMgb3ZzLXZzd2l0Y2hkKQogIGN1ckhhbmRsZXJzPSQocHMgLVRlbyBwaWQsdGlkLGNvbW0sY21kIHwgZ3JlcCAtZSBoYW5kbGVyIHwgZ3JlcCAtYyBvdnMtdnN3aXRjaGQpCgogICMgQ2FsY3VsYXRlIHRoZSBkZXNpcmVkIG51bWJlciBvZiB0aHJlYWRzIHRoZSBzYW1lIHdheSBPVlMgZG9lcy4KICAjIE9WUyB3aWxsIHNldCB0aGVzZSB0aHJlYWQgY291bnQgYXMgYSBvbmUgc2hvdCBwcm9jZXNzIG9uIHN0YXJ0dXAsIHNvIHdlCiAgIyBoYXZlIHRvIGFkanVzdCB1cCBvciBkb3duIGR1cmluZyB0aGUgYm9vdCB1cCBwcm9jZXNzLiBUaGUgZGVzaXJlZCBvdXRjb21lIGlzCiAgIyB0byBub3QgcmVzdHJpY3QgdGhlIG51bWJlciBvZiB0aHJlYWQgYXQgc3RhcnR1cCB1bnRpbCB3ZSByZWFjaCBhIHN0ZWFkeQogICMgc3RhdGUuICBBdCB3aGljaCBwb2ludCB3ZSBuZWVkIHRvIHJlc2V0IHRoZXNlIGJhc2VkIG9uIG91ciByZXN0cmljdGVkICBzZXQKICAjIG9mIGNvcmVzLgogICMgU2VlIE9WUyBmdW5jdGlvbiB0aGF0IGNhbGN1bGF0ZXMgdGhlc2UgdGhyZWFkIGNvdW50czoKICAjIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVudnN3aXRjaC9vdnMvYmxvYi9tYXN0ZXIvb2Zwcm90by9vZnByb3RvLWRwaWYtdXBjYWxsLmMjTDYzNQogICgoIGRlc2lyZWRSZXZhbGlkYXRvcnM9JGNwdWNvdW50IC8gNCArIDEgKSkKICAoKCBkZXNpcmVkSGFuZGxlcnM9JGNwdWNvdW50IC0gJGRlc2lyZWRSZXZhbGlkYXRvcnMgKSkKCgogIGlmIFtbICRjdXJSZXZhbGlkYXRvcnMgLW5lICRkZXNpcmVkUmV2YWxpZGF0b3JzIHx8ICRjdXJIYW5kbGVycyAtbmUgJGRlc2lyZWRIYW5kbGVycyBdXTsgdGhlbgoKICAgIGxvZ2dlciAiUmVjb3Zlcnk6IFJlLXNldHRpbmcgT1ZTIHJldmFsaWRhdG9yIHRocmVhZHM6ICR7Y3VyUmV2YWxpZGF0b3JzfSAtPiAke2Rlc2lyZWRSZXZhbGlkYXRvcnN9IgogICAgbG9nZ2VyICJSZWNvdmVyeTogUmUtc2V0dGluZyBPVlMgaGFuZGxlciB0aHJlYWRzOiAke2N1ckhhbmRsZXJzfSAtPiAke2Rlc2lyZWRIYW5kbGVyc30iCgogICAgb3ZzLXZzY3RsIHNldCBcCiAgICAgIE9wZW5fdlN3aXRjaCAuIFwKICAgICAgb3RoZXItY29uZmlnOm4taGFuZGxlci10aHJlYWRzPSR7ZGVzaXJlZEhhbmRsZXJzfSBcCiAgICAgIG90aGVyLWNvbmZpZzpuLXJldmFsaWRhdG9yLXRocmVhZHM9JHtkZXNpcmVkUmV2YWxpZGF0b3JzfQogICAgcmM9JD8KICBmaQoKICByZXR1cm4gJHJjCn0KCnJlc2V0QWZmaW5pdHkoKSB7CiAgbG9jYWwgY3B1c2V0PSIkMSIKICBsb2NhbCBmYWlsY291bnQ9MAogIGxvY2FsIHN1Y2Nlc3Njb3VudD0wCiAgbG9nZ2VyICJSZWNvdmVyeTogU2V0dGluZyBDUFUgYWZmaW5pdHkgZm9yIGNyaXRpY2FsIHByb2Nlc3NlcyBcIiRDUklUSUNBTF9QUk9DRVNTRVNcIiB0byAkY3B1c2V0IgogIGZvciBwcm9jIGluICRDUklUSUNBTF9QUk9DRVNTRVM7IGRvCiAgICBsb2NhbCBwaWRzPSIkKHBncmVwICRwcm9jKSIKICAgIGZvciBwaWQgaW4gJHBpZHM7IGRvCiAgICAgIGxvY2FsIHRhc2tzZXRPdXRwdXQKICAgICAgdGFza3NldE91dHB1dD0iJCh0YXNrc2V0IC1hcGMgIiRjcHVzZXQiICRwaWQgMj4mMSkiCiAgICAgIGlmIFtbICQ/IC1uZSAwIF1dOyB0aGVuCiAgICAgICAgZWNobyAiRVJST1I6ICR0YXNrc2V0T3V0cHV0IgogICAgICAgICgoZmFpbGNvdW50KyspKQogICAgICBlbHNlCiAgICAgICAgKChzdWNjZXNzY291bnQrKykpCiAgICAgIGZpCiAgICBkb25lCiAgZG9uZQoKICByZXNldE9WU3RocmVhZHMgIiQoZ2V0Q1BVQ291bnQgJHtjcHVzZXR9KSIKICBpZiBbWyAkPyAtbmUgMCBdXTsgdGhlbgogICAgKChmYWlsY291bnQrKykpCiAgZWxzZQogICAgKChzdWNjZXNzY291bnQrKykpCiAgZmkKCiAgbG9nZ2VyICJSZWNvdmVyeTogUmUtYWZmaW5lZCAkc3VjY2Vzc2NvdW50IHBpZHMgc3VjY2Vzc2Z1bGx5IgogIGlmIFtbICRmYWlsY291bnQgLWd0IDAgXV07IHRoZW4KICAgIGxvZ2dlciAiUmVjb3Zlcnk6IEZhaWxlZCB0byByZS1hZmZpbmUgJGZhaWxjb3VudCBwcm9jZXNzZXMiCiAgICByZXR1cm4gMQogIGZpCn0KCnNldFVucmVzdHJpY3RlZCgpIHsKICBsb2dnZXIgIlJlY292ZXJ5OiBTZXR0aW5nIGNyaXRpY2FsIHN5c3RlbSBwcm9jZXNzZXMgdG8gaGF2ZSB1bnJlc3RyaWN0ZWQgQ1BVIGFjY2VzcyIKICByZXNldEFmZmluaXR5ICIkKHVucmVzdHJpY3RlZENwdXNldCkiCn0KCnNldFJlc3RyaWN0ZWQoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogUmVzZXR0aW5nIGNyaXRpY2FsIHN5c3RlbSBwcm9jZXNzZXMgYmFjayB0byBub3JtYWxseSByZXN0cmljdGVkIGFjY2VzcyIKICByZXNldEFmZmluaXR5ICIkKHJlc3RyaWN0ZWRDcHVzZXQpIgp9CgpjdXJyZW50QWZmaW5pdHkoKSB7CiAgbG9jYWwgcGlkPSIkMSIKICB0YXNrc2V0IC1wYyAkcGlkIHwgYXdrIC1GJzogJyAne3ByaW50ICQyfScKfQoKd2l0aGluKCkgewogIGxvY2FsIGxhc3Q9JDEgY3VycmVudD0kMiB0aHJlc2hvbGQ9JDMKICBsb2NhbCBkZWx0YT0wIHBjaGFuZ2UKICBkZWx0YT0kKCggY3VycmVudCAtIGxhc3QgKSkKICBpZiBbWyAkY3VycmVudCAtZXEgJGxhc3QgXV07IHRoZW4KICAgIHBjaGFuZ2U9MAogIGVsaWYgW1sgJGxhc3QgLWVxIDAgXV07IHRoZW4KICAgIHBjaGFuZ2U9MTAwMDAwMAogIGVsc2UKICAgIHBjaGFuZ2U9JCgoICggJGRlbHRhICogMTAwKSAvIGxhc3QgKSkKICBmaQogIGVjaG8gLW4gImxhc3Q6JGxhc3QgY3VycmVudDokY3VycmVudCBkZWx0YTokZGVsdGEgcGNoYW5nZToke3BjaGFuZ2V9JTogIgogIGxvY2FsIGFic29sdXRlIGxpbWl0CiAgY2FzZSAkdGhyZXNob2xkIGluCiAgICAqJSkKICAgICAgYWJzb2x1dGU9JHtwY2hhbmdlIyMtfSAjIGFic29sdXRlIHZhbHVlCiAgICAgIGxpbWl0PSR7dGhyZXNob2xkJSUlfQogICAgICA7OwogICAgKikKICAgICAgYWJzb2x1dGU9JHtkZWx0YSMjLX0gIyBhYnNvbHV0ZSB2YWx1ZQogICAgICBsaW1pdD0kdGhyZXNob2xkCiAgICAgIDs7CiAgZXNhYwogIGlmIFtbICRhYnNvbHV0ZSAtbGUgJGxpbWl0IF1dOyB0aGVuCiAgICBlY2hvICJ3aXRoaW4gKCsvLSkkdGhyZXNob2xkIgogICAgcmV0dXJuIDAKICBlbHNlCiAgICBlY2hvICJvdXRzaWRlICgrLy0pJHRocmVzaG9sZCIKICAgIHJldHVybiAxCiAgZmkKfQoKc3RlYWR5c3RhdGUoKSB7CiAgbG9jYWwgbGFzdD0kMSBjdXJyZW50PSQyCiAgaWYgW1sgJGxhc3QgLWx0ICRTVEVBRFlfU1RBVEVfTUlOSU1VTSBdXTsgdGhlbgogICAgZWNobyAibGFzdDokbGFzdCBjdXJyZW50OiRjdXJyZW50IFdhaXRpbmcgdG8gcmVhY2ggJFNURUFEWV9TVEFURV9NSU5JTVVNIGJlZm9yZSBjaGVja2luZyBmb3Igc3RlYWR5LXN0YXRlIgogICAgcmV0dXJuIDEKICBmaQogIHdpdGhpbiAkbGFzdCAkY3VycmVudCAkU1RFQURZX1NUQVRFX1RIUkVTSE9MRAp9Cgp3YWl0Rm9yUmVhZHkoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogV2FpdGluZyAke01BWElNVU1fV0FJVF9USU1FfXMgZm9yIHRoZSBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSIKICBsb2NhbCBsYXN0U3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgbG9jYWwgbGFzdERlc2lyZWRDcHVzZXQ9IiQodW5yZXN0cmljdGVkQ3B1c2V0KSIKICBsb2NhbCB0PTAgcz0xMAogIGxvY2FsIGxhc3RDY291bnQ9MCBjY291bnQ9MCBzdGVhZHlTdGF0ZVRpbWU9MAogIHdoaWxlIFtbICR0IC1sdCAkTUFYSU1VTV9XQUlUX1RJTUUgXV07IGRvCiAgICBzbGVlcCAkcwogICAgKCh0ICs9IHMpKQogICAgIyBSZS1jaGVjayB0aGUgY3VycmVudCBhZmZpbml0eSBvZiBzeXN0ZW1kLCBpbiBjYXNlIHNvbWUgb3RoZXIgcHJvY2VzcyBoYXMgY2hhbmdlZCBpdAogICAgbG9jYWwgc3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgICAjIFJlLWNoZWNrIHRoZSB1bnJlc3RyaWN0ZWQgQ3B1c2V0LCBhcyB0aGUgYWxsb3dlZCBzZXQgb2YgdW5yZXNlcnZlZCBjb3JlcyBtYXkgY2hhbmdlIGFzIHBvZHMgYXJlIGFzc2lnbmVkIHRvIGNvcmVzCiAgICBsb2NhbCBkZXNpcmVkQ3B1c2V0PSIkKHVucmVzdHJpY3RlZENwdXNldCkiCiAgICBpZiBbWyAkc3lzdGVtZENwdXNldCAhPSAkbGFzdFN5c3RlbWRDcHVzZXQgfHwgJGxhc3REZXNpcmVkQ3B1c2V0ICE9ICRkZXNpcmVkQ3B1c2V0IF1dOyB0aGVuCiAgICAgIHJlc2V0QWZmaW5pdHkgIiRkZXNpcmVkQ3B1c2V0IgogICAgICBsYXN0U3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgICAgIGxhc3REZXNpcmVkQ3B1c2V0PSIkZGVzaXJlZENwdXNldCIKICAgIGZpCgogICAgIyBEZXRlY3Qgc3RlYWR5LXN0YXRlIHBvZCBjb3VudAogICAgY2NvdW50PSQoY3JpY3RsIHBzIHwgd2MgLWwpCiAgICBpZiBzdGVhZHlzdGF0ZSAkbGFzdENjb3VudCAkY2NvdW50OyB0aGVuCiAgICAgICgoc3RlYWR5U3RhdGVUaW1lICs9IHMpKQogICAgICBlY2hvICJTdGVhZHktc3RhdGUgZm9yICR7c3RlYWR5U3RhdGVUaW1lfXMvJHtTVEVBRFlfU1RBVEVfV0lORE9XfXMiCiAgICAgIGlmIFtbICRzdGVhZHlTdGF0ZVRpbWUgLWdlICRTVEVBRFlfU1RBVEVfV0lORE9XIF1dOyB0aGVuCiAgICAgICAgbG9nZ2VyICJSZWNvdmVyeTogU3RlYWR5LXN0YXRlICgrLy0gJFNURUFEWV9TVEFURV9USFJFU0hPTEQpIGZvciAke1NURUFEWV9TVEFURV9XSU5ET1d9czogRG9uZSIKICAgICAgICByZXR1cm4gMAogICAgICBmaQogICAgZWxzZQogICAgICBpZiBbWyAkc3RlYWR5U3RhdGVUaW1lIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgZWNobyAiUmVzZXR0aW5nIHN0ZWFkeS1zdGF0ZSB0aW1lciIKICAgICAgICBzdGVhZHlTdGF0ZVRpbWU9MAogICAgICBmaQogICAgZmkKICAgIGxhc3RDY291bnQ9JGNjb3VudAogIGRvbmUKICBsb2dnZXIgIlJlY292ZXJ5OiBSZWNvdmVyeSBDb21wbGV0ZSBUaW1lb3V0Igp9CgptYWluKCkgewogIGlmICEgdW5yZXN0cmljdGVkQ3B1c2V0ID4mL2Rldi9udWxsOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBObyB1bnJlc3RyaWN0ZWQgQ3B1c2V0IGNvdWxkIGJlIGRldGVjdGVkIgogICAgcmV0dXJuIDEKICBmaQoKICBpZiAhIHJlc3RyaWN0ZWRDcHVzZXQgPiYvZGV2L251bGw7IHRoZW4KICAgIGxvZ2dlciAiUmVjb3Zlcnk6IE5vIHJlc3RyaWN0ZWQgQ3B1c2V0IGhhcyBiZWVuIGNvbmZpZ3VyZWQuICBXZSBhcmUgYWxyZWFkeSBydW5uaW5nIHVucmVzdHJpY3RlZC4iCiAgICByZXR1cm4gMAogIGZpCgogICMgRW5zdXJlIHdlIHJlc2V0IHRoZSBDUFUgYWZmaW5pdHkgd2hlbiB3ZSBleGl0IHRoaXMgc2NyaXB0IGZvciBhbnkgcmVhc29uCiAgIyBUaGlzIHdheSBlaXRoZXIgYWZ0ZXIgdGhlIHRpbWVyIGV4cGlyZXMgb3IgYWZ0ZXIgdGhlIHByb2Nlc3MgaXMgaW50ZXJydXB0ZWQKICAjIHZpYSBeQyBvciBTSUdURVJNLCB3ZSByZXR1cm4gdGhpbmdzIGJhY2sgdG8gdGhlIHdheSB0aGV5IHNob3VsZCBiZS4KICB0cmFwIHNldFJlc3RyaWN0ZWQgRVhJVAoKICBsb2dnZXIgIlJlY292ZXJ5OiBSZWNvdmVyeSBNb2RlIFN0YXJ0aW5nIgogIHNldFVucmVzdHJpY3RlZAogIHdhaXRGb3JSZWFkeQp9CgppZiBbWyAiJHtCQVNIX1NPVVJDRVswXX0iID0gIiR7MH0iIF1dOyB0aGVuCiAgbWFpbiAiJHtAfSIKICBleGl0ICQ/CmZpCg==
                mode: 493
                path: /usr/local/bin/accelerated-container-startup.sh
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container startup

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold = 2%
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=2%%

                  # Steady-state window = 120s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=120

                  # Steady-state minimum = 40
                  # Increasing this will skip any steady-state checks until the count rises above
                  # this number to avoid false positives if there are some periods where the
                  # count doesn't increase but we know we can't be at steady-state yet.
                  Environment=STEADY_STATE_MINIMUM=40

                  [Install]
                  WantedBy=multi-user.target
                enabled: true
                name: accelerated-container-startup.service
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container shutdown
                  DefaultDependencies=no

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=-1

                  # Steady-state window = 60s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=60

                  [Install]
                  WantedBy=shutdown.target reboot.target halt.target
                enabled: true
                name: accelerated-container-shutdown.service
    04-accelerated-container-startup-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: 04-accelerated-container-startup-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIwojIFRlbXBvcmFyaWx5IHJlc2V0IHRoZSBjb3JlIHN5c3RlbSBwcm9jZXNzZXMncyBDUFUgYWZmaW5pdHkgdG8gYmUgdW5yZXN0cmljdGVkIHRvIGFjY2VsZXJhdGUgc3RhcnR1cCBhbmQgc2h1dGRvd24KIwojIFRoZSBkZWZhdWx0cyBiZWxvdyBjYW4gYmUgb3ZlcnJpZGRlbiB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzCiMKCiMgVGhlIGRlZmF1bHQgc2V0IG9mIGNyaXRpY2FsIHByb2Nlc3NlcyB3aG9zZSBhZmZpbml0eSBzaG91bGQgYmUgdGVtcG9yYXJpbHkgdW5ib3VuZDoKQ1JJVElDQUxfUFJPQ0VTU0VTPSR7Q1JJVElDQUxfUFJPQ0VTU0VTOi0ic3lzdGVtZCBvdnMgY3JpbyBrdWJlbGV0IE5ldHdvcmtNYW5hZ2VyIGNvbm1vbiBkYnVzIn0KCiMgRGVmYXVsdCB3YWl0IHRpbWUgaXMgNjAwcyA9IDEwbToKTUFYSU1VTV9XQUlUX1RJTUU9JHtNQVhJTVVNX1dBSVRfVElNRTotNjAwfQoKIyBEZWZhdWx0IHN0ZWFkeS1zdGF0ZSB0aHJlc2hvbGQgPSAyJQojIEFsbG93ZWQgdmFsdWVzOgojICA0ICAtIGFic29sdXRlIHBvZCBjb3VudCAoKy8tKQojICA0JSAtIHBlcmNlbnQgY2hhbmdlICgrLy0pCiMgIC0xIC0gZGlzYWJsZSB0aGUgc3RlYWR5LXN0YXRlIGNoZWNrClNURUFEWV9TVEFURV9USFJFU0hPTEQ9JHtTVEVBRFlfU1RBVEVfVEhSRVNIT0xEOi0yJX0KCiMgRGVmYXVsdCBzdGVhZHktc3RhdGUgd2luZG93ID0gNjBzCiMgSWYgdGhlIHJ1bm5pbmcgcG9kIGNvdW50IHN0YXlzIHdpdGhpbiB0aGUgZ2l2ZW4gdGhyZXNob2xkIGZvciB0aGlzIHRpbWUKIyBwZXJpb2QsIHJldHVybiBDUFUgdXRpbGl6YXRpb24gdG8gbm9ybWFsIGJlZm9yZSB0aGUgbWF4aW11bSB3YWl0IHRpbWUgaGFzCiMgZXhwaXJlcwpTVEVBRFlfU1RBVEVfV0lORE9XPSR7U1RFQURZX1NUQVRFX1dJTkRPVzotNjB9CgojIERlZmF1bHQgc3RlYWR5LXN0YXRlIGFsbG93cyBhbnkgcG9kIGNvdW50IHRvIGJlICJzdGVhZHkgc3RhdGUiCiMgSW5jcmVhc2luZyB0aGlzIHdpbGwgc2tpcCBhbnkgc3RlYWR5LXN0YXRlIGNoZWNrcyB1bnRpbCB0aGUgY291bnQgcmlzZXMgYWJvdmUKIyB0aGlzIG51bWJlciB0byBhdm9pZCBmYWxzZSBwb3NpdGl2ZXMgaWYgdGhlcmUgYXJlIHNvbWUgcGVyaW9kcyB3aGVyZSB0aGUKIyBjb3VudCBkb2Vzbid0IGluY3JlYXNlIGJ1dCB3ZSBrbm93IHdlIGNhbid0IGJlIGF0IHN0ZWFkeS1zdGF0ZSB5ZXQuClNURUFEWV9TVEFURV9NSU5JTVVNPSR7U1RFQURZX1NUQVRFX01JTklNVU06LTB9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpLVUJFTEVUX0NQVV9TVEFURT0vdmFyL2xpYi9rdWJlbGV0L2NwdV9tYW5hZ2VyX3N0YXRlCkZVTExfQ1BVX1NUQVRFPS9zeXMvZnMvY2dyb3VwL2NwdXNldC9jcHVzZXQuY3B1cwp1bnJlc3RyaWN0ZWRDcHVzZXQoKSB7CiAgbG9jYWwgY3B1cwogIGlmIFtbIC1lICRLVUJFTEVUX0NQVV9TVEFURSBdXTsgdGhlbgogICAgICBjcHVzPSQoanEgLXIgJy5kZWZhdWx0Q3B1U2V0JyA8JEtVQkVMRVRfQ1BVX1NUQVRFKQogIGZpCiAgaWYgW1sgLXogJGNwdXMgXV07IHRoZW4KICAgICMgZmFsbCBiYWNrIHRvIHVzaW5nIGFsbCBjcHVzIGlmIHRoZSBrdWJlbGV0IHN0YXRlIGlzIG5vdCBjb25maWd1cmVkIHlldAogICAgW1sgLWUgJEZVTExfQ1BVX1NUQVRFIF1dIHx8IHJldHVybiAxCiAgICBjcHVzPSQoPCRGVUxMX0NQVV9TVEFURSkKICBmaQogIGVjaG8gJGNwdXMKfQoKcmVzdHJpY3RlZENwdXNldCgpIHsKICBmb3IgYXJnIGluICQoPC9wcm9jL2NtZGxpbmUpOyBkbwogICAgaWYgW1sgJGFyZyA9fiBec3lzdGVtZC5jcHVfYWZmaW5pdHk9IF1dOyB0aGVuCiAgICAgIGVjaG8gJHthcmcjKj19CiAgICAgIHJldHVybiAwCiAgICBmaQogIGRvbmUKICByZXR1cm4gMQp9CgpnZXRDUFVDb3VudCAoKSB7CiAgbG9jYWwgY3B1c2V0PSIkMSIKICBsb2NhbCBjcHVsaXN0PSgpCiAgbG9jYWwgY3B1cz0wCiAgbG9jYWwgbWluY3B1cz0yCgogIGlmIFtbIC16ICRjcHVzZXQgfHwgJGNwdXNldCA9fiBbXjAtOSwtXSBdXTsgdGhlbgogICAgZWNobyAkbWluY3B1cwogICAgcmV0dXJuIDEKICBmaQoKICBJRlM9JywnIHJlYWQgLXJhIGNwdWxpc3QgPDw8ICRjcHVzZXQKCiAgZm9yIGVsbSBpbiAiJHtjcHVsaXN0W0BdfSI7IGRvCiAgICBpZiBbWyAkZWxtID1+IF5bMC05XSskIF1dOyB0aGVuCiAgICAgICgoIGNwdXMrKyApKQogICAgZWxpZiBbWyAkZWxtID1+IF5bMC05XSstWzAtOV0rJCBdXTsgdGhlbgogICAgICBsb2NhbCBsb3c9MCBoaWdoPTAKICAgICAgSUZTPSctJyByZWFkIGxvdyBoaWdoIDw8PCAkZWxtCiAgICAgICgoIGNwdXMgKz0gaGlnaCAtIGxvdyArIDEgKSkKICAgIGVsc2UKICAgICAgZWNobyAkbWluY3B1cwogICAgICByZXR1cm4gMQogICAgZmkKICBkb25lCgogICMgUmV0dXJuIGEgbWluaW11bSBvZiAyIGNwdXMKICBlY2hvICQoKCBjcHVzID4gJG1pbmNwdXMgPyBjcHVzIDogJG1pbmNwdXMgKSkKICByZXR1cm4gMAp9CgpyZXNldE9WU3RocmVhZHMgKCkgewogIGxvY2FsIGNwdWNvdW50PSIkMSIKICBsb2NhbCBjdXJSZXZhbGlkYXRvcnM9MAogIGxvY2FsIGN1ckhhbmRsZXJzPTAKICBsb2NhbCBkZXNpcmVkUmV2YWxpZGF0b3JzPTAKICBsb2NhbCBkZXNpcmVkSGFuZGxlcnM9MAogIGxvY2FsIHJjPTAKCiAgY3VyUmV2YWxpZGF0b3JzPSQocHMgLVRlbyBwaWQsdGlkLGNvbW0sY21kIHwgZ3JlcCAtZSByZXZhbGlkYXRvciB8IGdyZXAgLWMgb3ZzLXZzd2l0Y2hkKQogIGN1ckhhbmRsZXJzPSQocHMgLVRlbyBwaWQsdGlkLGNvbW0sY21kIHwgZ3JlcCAtZSBoYW5kbGVyIHwgZ3JlcCAtYyBvdnMtdnN3aXRjaGQpCgogICMgQ2FsY3VsYXRlIHRoZSBkZXNpcmVkIG51bWJlciBvZiB0aHJlYWRzIHRoZSBzYW1lIHdheSBPVlMgZG9lcy4KICAjIE9WUyB3aWxsIHNldCB0aGVzZSB0aHJlYWQgY291bnQgYXMgYSBvbmUgc2hvdCBwcm9jZXNzIG9uIHN0YXJ0dXAsIHNvIHdlCiAgIyBoYXZlIHRvIGFkanVzdCB1cCBvciBkb3duIGR1cmluZyB0aGUgYm9vdCB1cCBwcm9jZXNzLiBUaGUgZGVzaXJlZCBvdXRjb21lIGlzCiAgIyB0byBub3QgcmVzdHJpY3QgdGhlIG51bWJlciBvZiB0aHJlYWQgYXQgc3RhcnR1cCB1bnRpbCB3ZSByZWFjaCBhIHN0ZWFkeQogICMgc3RhdGUuICBBdCB3aGljaCBwb2ludCB3ZSBuZWVkIHRvIHJlc2V0IHRoZXNlIGJhc2VkIG9uIG91ciByZXN0cmljdGVkICBzZXQKICAjIG9mIGNvcmVzLgogICMgU2VlIE9WUyBmdW5jdGlvbiB0aGF0IGNhbGN1bGF0ZXMgdGhlc2UgdGhyZWFkIGNvdW50czoKICAjIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVudnN3aXRjaC9vdnMvYmxvYi9tYXN0ZXIvb2Zwcm90by9vZnByb3RvLWRwaWYtdXBjYWxsLmMjTDYzNQogICgoIGRlc2lyZWRSZXZhbGlkYXRvcnM9JGNwdWNvdW50IC8gNCArIDEgKSkKICAoKCBkZXNpcmVkSGFuZGxlcnM9JGNwdWNvdW50IC0gJGRlc2lyZWRSZXZhbGlkYXRvcnMgKSkKCgogIGlmIFtbICRjdXJSZXZhbGlkYXRvcnMgLW5lICRkZXNpcmVkUmV2YWxpZGF0b3JzIHx8ICRjdXJIYW5kbGVycyAtbmUgJGRlc2lyZWRIYW5kbGVycyBdXTsgdGhlbgoKICAgIGxvZ2dlciAiUmVjb3Zlcnk6IFJlLXNldHRpbmcgT1ZTIHJldmFsaWRhdG9yIHRocmVhZHM6ICR7Y3VyUmV2YWxpZGF0b3JzfSAtPiAke2Rlc2lyZWRSZXZhbGlkYXRvcnN9IgogICAgbG9nZ2VyICJSZWNvdmVyeTogUmUtc2V0dGluZyBPVlMgaGFuZGxlciB0aHJlYWRzOiAke2N1ckhhbmRsZXJzfSAtPiAke2Rlc2lyZWRIYW5kbGVyc30iCgogICAgb3ZzLXZzY3RsIHNldCBcCiAgICAgIE9wZW5fdlN3aXRjaCAuIFwKICAgICAgb3RoZXItY29uZmlnOm4taGFuZGxlci10aHJlYWRzPSR7ZGVzaXJlZEhhbmRsZXJzfSBcCiAgICAgIG90aGVyLWNvbmZpZzpuLXJldmFsaWRhdG9yLXRocmVhZHM9JHtkZXNpcmVkUmV2YWxpZGF0b3JzfQogICAgcmM9JD8KICBmaQoKICByZXR1cm4gJHJjCn0KCnJlc2V0QWZmaW5pdHkoKSB7CiAgbG9jYWwgY3B1c2V0PSIkMSIKICBsb2NhbCBmYWlsY291bnQ9MAogIGxvY2FsIHN1Y2Nlc3Njb3VudD0wCiAgbG9nZ2VyICJSZWNvdmVyeTogU2V0dGluZyBDUFUgYWZmaW5pdHkgZm9yIGNyaXRpY2FsIHByb2Nlc3NlcyBcIiRDUklUSUNBTF9QUk9DRVNTRVNcIiB0byAkY3B1c2V0IgogIGZvciBwcm9jIGluICRDUklUSUNBTF9QUk9DRVNTRVM7IGRvCiAgICBsb2NhbCBwaWRzPSIkKHBncmVwICRwcm9jKSIKICAgIGZvciBwaWQgaW4gJHBpZHM7IGRvCiAgICAgIGxvY2FsIHRhc2tzZXRPdXRwdXQKICAgICAgdGFza3NldE91dHB1dD0iJCh0YXNrc2V0IC1hcGMgIiRjcHVzZXQiICRwaWQgMj4mMSkiCiAgICAgIGlmIFtbICQ/IC1uZSAwIF1dOyB0aGVuCiAgICAgICAgZWNobyAiRVJST1I6ICR0YXNrc2V0T3V0cHV0IgogICAgICAgICgoZmFpbGNvdW50KyspKQogICAgICBlbHNlCiAgICAgICAgKChzdWNjZXNzY291bnQrKykpCiAgICAgIGZpCiAgICBkb25lCiAgZG9uZQoKICByZXNldE9WU3RocmVhZHMgIiQoZ2V0Q1BVQ291bnQgJHtjcHVzZXR9KSIKICBpZiBbWyAkPyAtbmUgMCBdXTsgdGhlbgogICAgKChmYWlsY291bnQrKykpCiAgZWxzZQogICAgKChzdWNjZXNzY291bnQrKykpCiAgZmkKCiAgbG9nZ2VyICJSZWNvdmVyeTogUmUtYWZmaW5lZCAkc3VjY2Vzc2NvdW50IHBpZHMgc3VjY2Vzc2Z1bGx5IgogIGlmIFtbICRmYWlsY291bnQgLWd0IDAgXV07IHRoZW4KICAgIGxvZ2dlciAiUmVjb3Zlcnk6IEZhaWxlZCB0byByZS1hZmZpbmUgJGZhaWxjb3VudCBwcm9jZXNzZXMiCiAgICByZXR1cm4gMQogIGZpCn0KCnNldFVucmVzdHJpY3RlZCgpIHsKICBsb2dnZXIgIlJlY292ZXJ5OiBTZXR0aW5nIGNyaXRpY2FsIHN5c3RlbSBwcm9jZXNzZXMgdG8gaGF2ZSB1bnJlc3RyaWN0ZWQgQ1BVIGFjY2VzcyIKICByZXNldEFmZmluaXR5ICIkKHVucmVzdHJpY3RlZENwdXNldCkiCn0KCnNldFJlc3RyaWN0ZWQoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogUmVzZXR0aW5nIGNyaXRpY2FsIHN5c3RlbSBwcm9jZXNzZXMgYmFjayB0byBub3JtYWxseSByZXN0cmljdGVkIGFjY2VzcyIKICByZXNldEFmZmluaXR5ICIkKHJlc3RyaWN0ZWRDcHVzZXQpIgp9CgpjdXJyZW50QWZmaW5pdHkoKSB7CiAgbG9jYWwgcGlkPSIkMSIKICB0YXNrc2V0IC1wYyAkcGlkIHwgYXdrIC1GJzogJyAne3ByaW50ICQyfScKfQoKd2l0aGluKCkgewogIGxvY2FsIGxhc3Q9JDEgY3VycmVudD0kMiB0aHJlc2hvbGQ9JDMKICBsb2NhbCBkZWx0YT0wIHBjaGFuZ2UKICBkZWx0YT0kKCggY3VycmVudCAtIGxhc3QgKSkKICBpZiBbWyAkY3VycmVudCAtZXEgJGxhc3QgXV07IHRoZW4KICAgIHBjaGFuZ2U9MAogIGVsaWYgW1sgJGxhc3QgLWVxIDAgXV07IHRoZW4KICAgIHBjaGFuZ2U9MTAwMDAwMAogIGVsc2UKICAgIHBjaGFuZ2U9JCgoICggJGRlbHRhICogMTAwKSAvIGxhc3QgKSkKICBmaQogIGVjaG8gLW4gImxhc3Q6JGxhc3QgY3VycmVudDokY3VycmVudCBkZWx0YTokZGVsdGEgcGNoYW5nZToke3BjaGFuZ2V9JTogIgogIGxvY2FsIGFic29sdXRlIGxpbWl0CiAgY2FzZSAkdGhyZXNob2xkIGluCiAgICAqJSkKICAgICAgYWJzb2x1dGU9JHtwY2hhbmdlIyMtfSAjIGFic29sdXRlIHZhbHVlCiAgICAgIGxpbWl0PSR7dGhyZXNob2xkJSUlfQogICAgICA7OwogICAgKikKICAgICAgYWJzb2x1dGU9JHtkZWx0YSMjLX0gIyBhYnNvbHV0ZSB2YWx1ZQogICAgICBsaW1pdD0kdGhyZXNob2xkCiAgICAgIDs7CiAgZXNhYwogIGlmIFtbICRhYnNvbHV0ZSAtbGUgJGxpbWl0IF1dOyB0aGVuCiAgICBlY2hvICJ3aXRoaW4gKCsvLSkkdGhyZXNob2xkIgogICAgcmV0dXJuIDAKICBlbHNlCiAgICBlY2hvICJvdXRzaWRlICgrLy0pJHRocmVzaG9sZCIKICAgIHJldHVybiAxCiAgZmkKfQoKc3RlYWR5c3RhdGUoKSB7CiAgbG9jYWwgbGFzdD0kMSBjdXJyZW50PSQyCiAgaWYgW1sgJGxhc3QgLWx0ICRTVEVBRFlfU1RBVEVfTUlOSU1VTSBdXTsgdGhlbgogICAgZWNobyAibGFzdDokbGFzdCBjdXJyZW50OiRjdXJyZW50IFdhaXRpbmcgdG8gcmVhY2ggJFNURUFEWV9TVEFURV9NSU5JTVVNIGJlZm9yZSBjaGVja2luZyBmb3Igc3RlYWR5LXN0YXRlIgogICAgcmV0dXJuIDEKICBmaQogIHdpdGhpbiAkbGFzdCAkY3VycmVudCAkU1RFQURZX1NUQVRFX1RIUkVTSE9MRAp9Cgp3YWl0Rm9yUmVhZHkoKSB7CiAgbG9nZ2VyICJSZWNvdmVyeTogV2FpdGluZyAke01BWElNVU1fV0FJVF9USU1FfXMgZm9yIHRoZSBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSIKICBsb2NhbCBsYXN0U3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgbG9jYWwgbGFzdERlc2lyZWRDcHVzZXQ9IiQodW5yZXN0cmljdGVkQ3B1c2V0KSIKICBsb2NhbCB0PTAgcz0xMAogIGxvY2FsIGxhc3RDY291bnQ9MCBjY291bnQ9MCBzdGVhZHlTdGF0ZVRpbWU9MAogIHdoaWxlIFtbICR0IC1sdCAkTUFYSU1VTV9XQUlUX1RJTUUgXV07IGRvCiAgICBzbGVlcCAkcwogICAgKCh0ICs9IHMpKQogICAgIyBSZS1jaGVjayB0aGUgY3VycmVudCBhZmZpbml0eSBvZiBzeXN0ZW1kLCBpbiBjYXNlIHNvbWUgb3RoZXIgcHJvY2VzcyBoYXMgY2hhbmdlZCBpdAogICAgbG9jYWwgc3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgICAjIFJlLWNoZWNrIHRoZSB1bnJlc3RyaWN0ZWQgQ3B1c2V0LCBhcyB0aGUgYWxsb3dlZCBzZXQgb2YgdW5yZXNlcnZlZCBjb3JlcyBtYXkgY2hhbmdlIGFzIHBvZHMgYXJlIGFzc2lnbmVkIHRvIGNvcmVzCiAgICBsb2NhbCBkZXNpcmVkQ3B1c2V0PSIkKHVucmVzdHJpY3RlZENwdXNldCkiCiAgICBpZiBbWyAkc3lzdGVtZENwdXNldCAhPSAkbGFzdFN5c3RlbWRDcHVzZXQgfHwgJGxhc3REZXNpcmVkQ3B1c2V0ICE9ICRkZXNpcmVkQ3B1c2V0IF1dOyB0aGVuCiAgICAgIHJlc2V0QWZmaW5pdHkgIiRkZXNpcmVkQ3B1c2V0IgogICAgICBsYXN0U3lzdGVtZENwdXNldD0iJChjdXJyZW50QWZmaW5pdHkgMSkiCiAgICAgIGxhc3REZXNpcmVkQ3B1c2V0PSIkZGVzaXJlZENwdXNldCIKICAgIGZpCgogICAgIyBEZXRlY3Qgc3RlYWR5LXN0YXRlIHBvZCBjb3VudAogICAgY2NvdW50PSQoY3JpY3RsIHBzIHwgd2MgLWwpCiAgICBpZiBzdGVhZHlzdGF0ZSAkbGFzdENjb3VudCAkY2NvdW50OyB0aGVuCiAgICAgICgoc3RlYWR5U3RhdGVUaW1lICs9IHMpKQogICAgICBlY2hvICJTdGVhZHktc3RhdGUgZm9yICR7c3RlYWR5U3RhdGVUaW1lfXMvJHtTVEVBRFlfU1RBVEVfV0lORE9XfXMiCiAgICAgIGlmIFtbICRzdGVhZHlTdGF0ZVRpbWUgLWdlICRTVEVBRFlfU1RBVEVfV0lORE9XIF1dOyB0aGVuCiAgICAgICAgbG9nZ2VyICJSZWNvdmVyeTogU3RlYWR5LXN0YXRlICgrLy0gJFNURUFEWV9TVEFURV9USFJFU0hPTEQpIGZvciAke1NURUFEWV9TVEFURV9XSU5ET1d9czogRG9uZSIKICAgICAgICByZXR1cm4gMAogICAgICBmaQogICAgZWxzZQogICAgICBpZiBbWyAkc3RlYWR5U3RhdGVUaW1lIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgZWNobyAiUmVzZXR0aW5nIHN0ZWFkeS1zdGF0ZSB0aW1lciIKICAgICAgICBzdGVhZHlTdGF0ZVRpbWU9MAogICAgICBmaQogICAgZmkKICAgIGxhc3RDY291bnQ9JGNjb3VudAogIGRvbmUKICBsb2dnZXIgIlJlY292ZXJ5OiBSZWNvdmVyeSBDb21wbGV0ZSBUaW1lb3V0Igp9CgptYWluKCkgewogIGlmICEgdW5yZXN0cmljdGVkQ3B1c2V0ID4mL2Rldi9udWxsOyB0aGVuCiAgICBsb2dnZXIgIlJlY292ZXJ5OiBObyB1bnJlc3RyaWN0ZWQgQ3B1c2V0IGNvdWxkIGJlIGRldGVjdGVkIgogICAgcmV0dXJuIDEKICBmaQoKICBpZiAhIHJlc3RyaWN0ZWRDcHVzZXQgPiYvZGV2L251bGw7IHRoZW4KICAgIGxvZ2dlciAiUmVjb3Zlcnk6IE5vIHJlc3RyaWN0ZWQgQ3B1c2V0IGhhcyBiZWVuIGNvbmZpZ3VyZWQuICBXZSBhcmUgYWxyZWFkeSBydW5uaW5nIHVucmVzdHJpY3RlZC4iCiAgICByZXR1cm4gMAogIGZpCgogICMgRW5zdXJlIHdlIHJlc2V0IHRoZSBDUFUgYWZmaW5pdHkgd2hlbiB3ZSBleGl0IHRoaXMgc2NyaXB0IGZvciBhbnkgcmVhc29uCiAgIyBUaGlzIHdheSBlaXRoZXIgYWZ0ZXIgdGhlIHRpbWVyIGV4cGlyZXMgb3IgYWZ0ZXIgdGhlIHByb2Nlc3MgaXMgaW50ZXJydXB0ZWQKICAjIHZpYSBeQyBvciBTSUdURVJNLCB3ZSByZXR1cm4gdGhpbmdzIGJhY2sgdG8gdGhlIHdheSB0aGV5IHNob3VsZCBiZS4KICB0cmFwIHNldFJlc3RyaWN0ZWQgRVhJVAoKICBsb2dnZXIgIlJlY292ZXJ5OiBSZWNvdmVyeSBNb2RlIFN0YXJ0aW5nIgogIHNldFVucmVzdHJpY3RlZAogIHdhaXRGb3JSZWFkeQp9CgppZiBbWyAiJHtCQVNIX1NPVVJDRVswXX0iID0gIiR7MH0iIF1dOyB0aGVuCiAgbWFpbiAiJHtAfSIKICBleGl0ICQ/CmZpCg==
                mode: 493
                path: /usr/local/bin/accelerated-container-startup.sh
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container startup

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold = 2%
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=2%%

                  # Steady-state window = 120s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=120

                  # Steady-state minimum = 40
                  # Increasing this will skip any steady-state checks until the count rises above
                  # this number to avoid false positives if there are some periods where the
                  # count doesn't increase but we know we can't be at steady-state yet.
                  Environment=STEADY_STATE_MINIMUM=40

                  [Install]
                  WantedBy=multi-user.target
                enabled: true
                name: accelerated-container-startup.service
              - contents: |
                  [Unit]
                  Description=Unlocks more CPUs for critical system processes during container shutdown
                  DefaultDependencies=no

                  [Service]
                  Type=simple
                  ExecStart=/usr/local/bin/accelerated-container-startup.sh

                  # Maximum wait time is 600s = 10m:
                  Environment=MAXIMUM_WAIT_TIME=600

                  # Steady-state threshold
                  # Allowed values:
                  #  4  - absolute pod count (+/-)
                  #  4% - percent change (+/-)
                  #  -1 - disable the steady-state check
                  # Note: '%' must be escaped as '%%' in systemd unit files
                  Environment=STEADY_STATE_THRESHOLD=-1

                  # Steady-state window = 60s
                  # If the running pod count stays within the given threshold for this time
                  # period, return CPU utilization to normal before the maximum wait time has
                  # expires
                  Environment=STEADY_STATE_WINDOW=60

                  [Install]
                  WantedBy=shutdown.target reboot.target halt.target
                enabled: true
                name: accelerated-container-shutdown.service
    05-chrony-dynamic-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: 05-chronyd-dynamic-master
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIyBFdmFsdWF0ZSBQVFAgc3luY2hyb25pemF0aW9uIHN0YXRlIGFuZCBjcmVhdGUgb3IgZGVsZXRlIAojIHRoZSBjaHJvbnlkLnNlcnZpY2UgY29uZGl0aW9uIGZpbGUgYWNjb3JkaW5nbHkKCiMgVGhlIHBhcmFtZXRlcyBiZWxvdyBhcmUgdHVuZWQgdXNpbmcgY2hyb255ZC1yZXN0YXJ0LnNlcnZpY2UgZHJvcC1pbgojIE1heGltdW0gUFRQIG9mZnNldCB0byBiZSBjb25zaWRlcmVkIGluLXN5bmMgKG5zKQpNQVhfT0ZGU0VUPSR7TUFYX09GRlNFVDotMTAwMDAwfQojIFBUUCBvZmZzZXQgaHlzdGVyZXNpcyB0aHJlc2hvbGQgKG5zKQpPRkZTRVRfVEhSRVNIT0xEPSR7T0ZGU0VUX1RIUkVTSE9MRDotMjAwMDB9CiMgTWF4aW11bSB2YWxpZCBtZWFzdXJlbWVudCBhZ2UgKHMpClNZTkNfQUdFPSR7U1lOQ19BR0U6LTYwMH0KCiMgRmlsZSBmb3Igc3RhcnRpbmcgY2hyb255ZCBjb25kaXRpb25hbGx5ClNZTkNfTUFSS0VSX1BBVEg9Ii92YXIvcnVuL3B0cC9pbnN5bmMiCgojIEF1eGlsaWFyeSBsb2dnaW5nIGZ1bmN0aW9uCmZ1bmN0aW9uIGxvZ19kZWJ1ZygpewogIGxvY2FsIExPR0dFUl9UQUc9InB0cC1jaHJvbnlkIgogIGxvZ2dlciAtdCAkTE9HR0VSX1RBRyAtcCAic3lzbG9nLmRlYnVnIiAiJDEiCn0KCiMgQ29tcGFyZSBmbG9hdGluZyBwb2ludCBudW1iZXJzCmZ1bmN0aW9uIGdyZWF0ZXIoKSB7CiAgIGF3ayAtdiBuMT0iJDEiIC12IG4yPSIkMiIgJ0JFR0lOIHtwcmludGYgKG4xPm4yPyJ0cnVlIjoiZmFsc2UiKSJcbiIsIG4xLCBuMn0nCn0KCiMgUmV0dXJuIGFic29sdXRlIChmb3IgbWFzdGVyIG9mZnNldCkKZnVuY3Rpb24gYWJzKCkgeyAKICAgIGVjaG8gJHsxIyMtfQp9CgojIENoZWNrIHZhcmlhYmxlIGlzIGRlZmluZWQKZnVuY3Rpb24gdmFyX2RlZmluZWQoKSB7CiAgVkFSPSIkMSIKICBpZiBbWyAkeyNWQVJ9IC1lcSAwIF1dOyB0aGVuIAogICAgbG9nX2RlYnVnICJTYW5pdHkgY2hlY2sgcmVzdWx0IGF0IGxpbmUgJChjYWxsZXIpOiBQVFAgbWlnaHQgbm90IGJlIHJ1bm5pbmciICAgIAogICAgcmV0dXJuIDEKICBmaQogIHJldHVybiAwCn0KCiMgR2V0IHRoZSBsYXN0IGxpbmUgY29udGFpbmluZyBtYXN0ZXJvZmZzZXQgZnJvbSB0aGUgbGF0ZXN0IGF2YWlsYWJsZSBsb2cKIyBBUkdVTUVOVFM6CiMgICBub25lCiMgR0xPQkFMOgojICAgbm9uZQojIE9VVFBVVDoKIyAgIExhc3QgbGluZSBvZiB0aGUgbG9nIGNvbnRhaW5pbmcgb2Zmc2V0IGFuZCB0aW1lc3RhbXAKIyAgICAgU29tZXRoaW5nIGxpa2UgIjIwMjEtMTAtMThUMTY6NDc6MDYuMDIyOTgzNjY1KzAwOjAwIHN0ZG91dCBGIHB0cDRsWzgxODAuMTUwXTogW2VuczRmMF0gCiMgICAgIG1hc3RlciBvZmZzZXQgMyBzMiBmcmVxIC0xNjc1NjE2OSBwYXRoIGRlbGF5IDE0ODEiCiMgUkVUVVJOOgojICAgMCBpZiBhbGwgc2FuaXR5IGNoZWNrcyBwYXNzZWQsIDEgb3RoZXJ3aXNlCmdldF9sYXN0X3B0cF9zdGF0dXMoKSB7CiAgbG9jYWwgQ09OVEFJTkVSX0lEPSQoY3JpY3RsIHBzIC0tbmFtZSBsaW51eHB0cC1kYWVtb24tY29udGFpbmVyIC0tbGF0ZXN0IC0tc3RhdGUgUnVubmluZyAtLXF1aWV0KQogIGlmICEgdmFyX2RlZmluZWQgJENPTlRBSU5FUl9JRDsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIGxvY2FsIExPR19OQU1FPSQoY3JpY3RsIGluc3BlY3QgLW8ganNvbiAkQ09OVEFJTkVSX0lEIHxqcSAnLnN0YXR1cy5sb2dQYXRoJykKICBpZiAhIHZhcl9kZWZpbmVkICRMT0dfTkFNRTsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIExPR19OQU1FPSR7TE9HX05BTUUvL1wiL30KICBsb2NhbCBMQVNUX1NUQVRVUz0kKHRhaWwgLTIwMDAgJExPR19OQU1FIHxncmVwICJdIG1hc3RlciBvZmZzZXQiIHx0YWlsIC0xKQogIGlmICEgdmFyX2RlZmluZWQgJExBU1RfU1RBVFVTOyB0aGVuCiAgICByZXR1cm4gMQogIGZpCiAgZWNobyAiJHtMQVNUX1NUQVRVU30iCiAgbG9nX2RlYnVnICIke0xBU1RfU1RBVFVTfSIKICByZXR1cm4gMAp9CgojIEdldCB0aGUgdGltZSBvZmZzZXQgYW5kIGFzc29jaWF0ZWQgdGltZXN0YW1wIGZyb20gcHRwNGwgbG9nIGxpbmUKIyBBUkdVTUVOVFM6CiMgICBub25lCiMgR0xPQkFMOgojICAgU1lOQ19BR0UgLSBNYXhpbXVtIGFsbG93ZWQgYWdlIGluIHNlY29uZHMgb2YgYSBsb2cgbGluZSB0byBiZSBjb25zaWRlcmVkIHZhbGlkCiMgICAgIGZvciBzeW5jIGV2YWx1YXRpb24KIyBPVVRQVVQ6CiMgICBBQlNfT0ZGU0VUX1ZBTFVFIC0gaW4gbnMKIyBSRVRVUk46CiMgICAwIGlmIHRpbWUgb2Zmc2V0IGlzIHZhbGlkLCAxIGlmIG5vdApnZXRfcHRwX29mZnNldCgpIHsKICBsb2NhbCBMQVNUX1NUQVRVUwogIExBU1RfU1RBVFVTPSQoZ2V0X2xhc3RfcHRwX3N0YXR1cykKICAKICBpZiBbWyAkPyAtbmUgMCBdXTsgdGhlbgogICAgbG9nX2RlYnVnICJObyB2YWxpZCBsaW51eHB0cCBzdGF0dXMuIgogICAgcmV0dXJuIDEKICBmaQogIGxvY2FsIFNUUklOR19BUlJBWT0oJExBU1RfU1RBVFVTKQogIGxvY2FsIE9GRlNFVF9EQVRFPSR7U1RSSU5HX0FSUkFZWzBdfQogIGRlY2xhcmUgLWkgT0ZGU0VUX1ZBTFVFCiAgT0ZGU0VUX1ZBTFVFPSR7U1RSSU5HX0FSUkFZWzddfQogIGRlY2xhcmUgLWkgQUJTX09GRlNFVF9WQUxVRQogIGxvY2FsIEFCU19PRkZTRVRfVkFMVUU9JChhYnMgJE9GRlNFVF9WQUxVRSkKICBsb2dfZGVidWcgIlBUUCBvZmZzZXQ6ICRPRkZTRVRfVkFMVUUsIGFicyBvZmZzZXQgJEFCU19PRkZTRVRfVkFMVUUsdGltZXN0YW1wICRPRkZTRVRfREFURSIKCiAgIyBDaGVjayBob3cgZnJlc2ggaXMgdGhlIG9mZnNldCBtZWFzdXJlbWVudCB0byBwcm90ZWN0CiAgIyBmcm9tIGxvb2tpbmcgYXQgdGhlIG9sZCBsb2cgdGhhdCBoYXMgbm90IGJlZW4gY2xlYW5lZCBmcm9tIHRoZSBzeXN0ZW0KICBsb2NhbCBDVVJSRU5UX1RJTUU9IiQoZGF0ZSArJXMuJU4pIiAjIGN1cnJlbnQgZGF0ZSBpbiBuYW5vc2Vjb25kcwogIGxvY2FsIE9GRlNFVF9USU1FU1RBTVA9IiQoZGF0ZSArJXMuJU4gLWQgIiRPRkZTRVRfREFURSIpIiAjIG1lYXN1cmVtZW50IGRhdGUgaW4gbnMKICBsb2NhbCBUSU1FX0RJRkY9JChhd2sgJ3twcmludCAkMS0kMn0nIDw8PCIke0NVUlJFTlRfVElNRX0gJHtPRkZTRVRfVElNRVNUQU1QfSIpCiAgZWNobyAiJHtBQlNfT0ZGU0VUX1ZBTFVFfSIKICBpZiAkKGdyZWF0ZXIgJFRJTUVfRElGRiAkU1lOQ19BR0UpOyB0aGVuCiAgICByZXR1cm4gMQogIGVsc2UKICAgIHJldHVybiAwCiAgZmkKfQoKIyBDaGVjayBpZiBQVFAgaXMgc3luY2VkCiMgQVJHVU1FTlRTOgojICAgbm9uZQojIEdMT0JBTDoKIyAgIFNZTkNfTUFSS0VSX1BBVEggLSBGaWxlIGZvciBzdGFydGluZyBjaHJvbnlkIGNvbmRpdGlvbmFsbHkuIFVzZWQgdG8gZmluZCB0aGUgCiMgICAgICBsYXN0IGtub3duIHB0cCBzeW5jIHN0YXRlIGFuZCBhcHBseSBoeXN0ZXJlc2lzIHRocmVzaG9sZAojICAgTUFYX09GRlNFVCAtIE1heGltdW0gYWxsb3dlZCBjbG9jayBvZmZzZXQgaW4gbmFub3NlY29uZHMKIyAgIE9GRlNFVF9USFJFU0hPTEQgLSBoeXN0ZXJlc2lzIHRocmVzaG9sZAojICAgQUJTX09GRlNFVF9WQUxVRSAtIFBUUCBjbG9jayBvZmZzZXQKIyBPVVRQVVQ6CiMgICBub25lCiMgUkVUVVJOOgojICAgMCBpZiB0aGUgb2Zmc2V0IGlzIHdpdGhpbiB0aGUgYm91bmRhcmllcywgMSBpZiBub3QKcHRwX3N5bmNlZCgpIHsKICBkZWNsYXJlIC1pIE9GRlNFVAogIE9GRlNFVD0kKGdldF9wdHBfb2Zmc2V0KQogIGlmIFtbICQ/IC1uZSAwIF1dOyB0aGVuCiAgICBsb2dfZGVidWcgIk5vIHZhbGlkIHB0cCBvZmZzZXQuIgogICAgcmV0dXJuIDEKICBmaQogIGlmIFtbIC1mICIkU1lOQ19NQVJLRVJfUEFUSCIgXV07IHRoZW4KICAgIGxvZ19kZWJ1ZyAiTGFzdCBrbm93biBwdHAgc3RhdGUgLSBzeW5jaHJvbml6ZWQiCiAgICAoKE1BWF9PRkZTRVQ9TUFYX09GRlNFVCtPRkZTRVRfVEhSRVNIT0xEKSkKICBlbHNlCiAgICBsb2dfZGVidWcgIkxhc3Qga25vd24gcHRwIHN0YXRlIC0gdW5zeW5jaHJvbml6ZWQiCiAgICAoKE1BWF9PRkZTRVQ9TUFYX09GRlNFVC1PRkZTRVRfVEhSRVNIT0xEKSkKICBmaQogIGlmIFsgJE9GRlNFVCAtZ3QgJE1BWF9PRkZTRVQgXTsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIHJldHVybiAwCn0KCgojIElmIHB0cCBpcyBzeW5jZWQgYW5kIHRoZSBvZmZzZXQgaXMgdmFsaWQsIGNyZWF0ZSBjaHJvbnlkIG1hcmtlcgojIE90aGVyd2lzZSBkZWxldGUgdGhlIG1hcmtlcgptYWluKCkgewogIGlmIHB0cF9zeW5jZWQ7IHRoZW4KICAgIGxvZ19kZWJ1ZyAiZW5zdXJlICRTWU5DX01BUktFUl9QQVRIIGV4aXN0cyIKICAgIHRvdWNoICRTWU5DX01BUktFUl9QQVRICiAgZWxzZQogICAgbG9nX2RlYnVnICJlbnN1cmUgJFNZTkNfTUFSS0VSX1BBVEggZG9lcyBub3QgZXhpc3QiCiAgICBybSAkU1lOQ19NQVJLRVJfUEFUSCAmPiAvZGV2L251bAogIGZpCn0KCmlmIFtbICIke0JBU0hfU09VUkNFWzBdfSIgPSAiJHswfSIgXV07IHRoZW4KICBtYWluICIke0B9IgogIGV4aXQgJD8KZmkK
                mode: 493
                path: /usr/local/bin/ptp-sync-check
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIyBSdW4gUFRQIHN0YXRlIGV2YWx1YXRpb24gc2NyaXB0IGFuZCByZXN0YXJ0IHRoZSBjaHJvbnlkLnNlcnZpY2UKL3Vzci9sb2NhbC9iaW4vcHRwLXN5bmMtY2hlY2sKL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBjaHJvbnlkLnNlcnZpY2U=
                mode: 493
                path: /usr/local/bin/restart-chronyd
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Restart chronyd

                  [Service]
                  Type=oneshot
                  Environment=MAX_OFFSET=100000
                  Environment=OFFSET_THRESHOLD=20000
                  Environment=SYNC_AGE=600
                  ExecStart=/usr/local/bin/restart-chronyd
                name: chronyd-restart.service
              - contents: |
                  [Unit]
                  Description=Restart chronyd periodically

                  [Timer]
                  OnCalendar=*:0/5

                  [Install]
                  WantedBy=timers.target
                enabled: true
                name: chronyd-restart.timer
              - dropins:
                - contents: |-
                    [Unit]
                    ConditionPathExists=!/var/run/ptp/insync
                  name: 20-conditional-start.conf
                name: chronyd.service
    05-chrony-dynamic-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: 05-chronyd-dynamic-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            storage:
              files:
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIyBFdmFsdWF0ZSBQVFAgc3luY2hyb25pemF0aW9uIHN0YXRlIGFuZCBjcmVhdGUgb3IgZGVsZXRlIAojIHRoZSBjaHJvbnlkLnNlcnZpY2UgY29uZGl0aW9uIGZpbGUgYWNjb3JkaW5nbHkKCiMgVGhlIHBhcmFtZXRlcyBiZWxvdyBhcmUgdHVuZWQgdXNpbmcgY2hyb255ZC1yZXN0YXJ0LnNlcnZpY2UgZHJvcC1pbgojIE1heGltdW0gUFRQIG9mZnNldCB0byBiZSBjb25zaWRlcmVkIGluLXN5bmMgKG5zKQpNQVhfT0ZGU0VUPSR7TUFYX09GRlNFVDotMTAwMDAwfQojIFBUUCBvZmZzZXQgaHlzdGVyZXNpcyB0aHJlc2hvbGQgKG5zKQpPRkZTRVRfVEhSRVNIT0xEPSR7T0ZGU0VUX1RIUkVTSE9MRDotMjAwMDB9CiMgTWF4aW11bSB2YWxpZCBtZWFzdXJlbWVudCBhZ2UgKHMpClNZTkNfQUdFPSR7U1lOQ19BR0U6LTYwMH0KCiMgRmlsZSBmb3Igc3RhcnRpbmcgY2hyb255ZCBjb25kaXRpb25hbGx5ClNZTkNfTUFSS0VSX1BBVEg9Ii92YXIvcnVuL3B0cC9pbnN5bmMiCgojIEF1eGlsaWFyeSBsb2dnaW5nIGZ1bmN0aW9uCmZ1bmN0aW9uIGxvZ19kZWJ1ZygpewogIGxvY2FsIExPR0dFUl9UQUc9InB0cC1jaHJvbnlkIgogIGxvZ2dlciAtdCAkTE9HR0VSX1RBRyAtcCAic3lzbG9nLmRlYnVnIiAiJDEiCn0KCiMgQ29tcGFyZSBmbG9hdGluZyBwb2ludCBudW1iZXJzCmZ1bmN0aW9uIGdyZWF0ZXIoKSB7CiAgIGF3ayAtdiBuMT0iJDEiIC12IG4yPSIkMiIgJ0JFR0lOIHtwcmludGYgKG4xPm4yPyJ0cnVlIjoiZmFsc2UiKSJcbiIsIG4xLCBuMn0nCn0KCiMgUmV0dXJuIGFic29sdXRlIChmb3IgbWFzdGVyIG9mZnNldCkKZnVuY3Rpb24gYWJzKCkgeyAKICAgIGVjaG8gJHsxIyMtfQp9CgojIENoZWNrIHZhcmlhYmxlIGlzIGRlZmluZWQKZnVuY3Rpb24gdmFyX2RlZmluZWQoKSB7CiAgVkFSPSIkMSIKICBpZiBbWyAkeyNWQVJ9IC1lcSAwIF1dOyB0aGVuIAogICAgbG9nX2RlYnVnICJTYW5pdHkgY2hlY2sgcmVzdWx0IGF0IGxpbmUgJChjYWxsZXIpOiBQVFAgbWlnaHQgbm90IGJlIHJ1bm5pbmciICAgIAogICAgcmV0dXJuIDEKICBmaQogIHJldHVybiAwCn0KCiMgR2V0IHRoZSBsYXN0IGxpbmUgY29udGFpbmluZyBtYXN0ZXJvZmZzZXQgZnJvbSB0aGUgbGF0ZXN0IGF2YWlsYWJsZSBsb2cKIyBBUkdVTUVOVFM6CiMgICBub25lCiMgR0xPQkFMOgojICAgbm9uZQojIE9VVFBVVDoKIyAgIExhc3QgbGluZSBvZiB0aGUgbG9nIGNvbnRhaW5pbmcgb2Zmc2V0IGFuZCB0aW1lc3RhbXAKIyAgICAgU29tZXRoaW5nIGxpa2UgIjIwMjEtMTAtMThUMTY6NDc6MDYuMDIyOTgzNjY1KzAwOjAwIHN0ZG91dCBGIHB0cDRsWzgxODAuMTUwXTogW2VuczRmMF0gCiMgICAgIG1hc3RlciBvZmZzZXQgMyBzMiBmcmVxIC0xNjc1NjE2OSBwYXRoIGRlbGF5IDE0ODEiCiMgUkVUVVJOOgojICAgMCBpZiBhbGwgc2FuaXR5IGNoZWNrcyBwYXNzZWQsIDEgb3RoZXJ3aXNlCmdldF9sYXN0X3B0cF9zdGF0dXMoKSB7CiAgbG9jYWwgQ09OVEFJTkVSX0lEPSQoY3JpY3RsIHBzIC0tbmFtZSBsaW51eHB0cC1kYWVtb24tY29udGFpbmVyIC0tbGF0ZXN0IC0tc3RhdGUgUnVubmluZyAtLXF1aWV0KQogIGlmICEgdmFyX2RlZmluZWQgJENPTlRBSU5FUl9JRDsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIGxvY2FsIExPR19OQU1FPSQoY3JpY3RsIGluc3BlY3QgLW8ganNvbiAkQ09OVEFJTkVSX0lEIHxqcSAnLnN0YXR1cy5sb2dQYXRoJykKICBpZiAhIHZhcl9kZWZpbmVkICRMT0dfTkFNRTsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIExPR19OQU1FPSR7TE9HX05BTUUvL1wiL30KICBsb2NhbCBMQVNUX1NUQVRVUz0kKHRhaWwgLTIwMDAgJExPR19OQU1FIHxncmVwICJdIG1hc3RlciBvZmZzZXQiIHx0YWlsIC0xKQogIGlmICEgdmFyX2RlZmluZWQgJExBU1RfU1RBVFVTOyB0aGVuCiAgICByZXR1cm4gMQogIGZpCiAgZWNobyAiJHtMQVNUX1NUQVRVU30iCiAgbG9nX2RlYnVnICIke0xBU1RfU1RBVFVTfSIKICByZXR1cm4gMAp9CgojIEdldCB0aGUgdGltZSBvZmZzZXQgYW5kIGFzc29jaWF0ZWQgdGltZXN0YW1wIGZyb20gcHRwNGwgbG9nIGxpbmUKIyBBUkdVTUVOVFM6CiMgICBub25lCiMgR0xPQkFMOgojICAgU1lOQ19BR0UgLSBNYXhpbXVtIGFsbG93ZWQgYWdlIGluIHNlY29uZHMgb2YgYSBsb2cgbGluZSB0byBiZSBjb25zaWRlcmVkIHZhbGlkCiMgICAgIGZvciBzeW5jIGV2YWx1YXRpb24KIyBPVVRQVVQ6CiMgICBBQlNfT0ZGU0VUX1ZBTFVFIC0gaW4gbnMKIyBSRVRVUk46CiMgICAwIGlmIHRpbWUgb2Zmc2V0IGlzIHZhbGlkLCAxIGlmIG5vdApnZXRfcHRwX29mZnNldCgpIHsKICBsb2NhbCBMQVNUX1NUQVRVUwogIExBU1RfU1RBVFVTPSQoZ2V0X2xhc3RfcHRwX3N0YXR1cykKICAKICBpZiBbWyAkPyAtbmUgMCBdXTsgdGhlbgogICAgbG9nX2RlYnVnICJObyB2YWxpZCBsaW51eHB0cCBzdGF0dXMuIgogICAgcmV0dXJuIDEKICBmaQogIGxvY2FsIFNUUklOR19BUlJBWT0oJExBU1RfU1RBVFVTKQogIGxvY2FsIE9GRlNFVF9EQVRFPSR7U1RSSU5HX0FSUkFZWzBdfQogIGRlY2xhcmUgLWkgT0ZGU0VUX1ZBTFVFCiAgT0ZGU0VUX1ZBTFVFPSR7U1RSSU5HX0FSUkFZWzddfQogIGRlY2xhcmUgLWkgQUJTX09GRlNFVF9WQUxVRQogIGxvY2FsIEFCU19PRkZTRVRfVkFMVUU9JChhYnMgJE9GRlNFVF9WQUxVRSkKICBsb2dfZGVidWcgIlBUUCBvZmZzZXQ6ICRPRkZTRVRfVkFMVUUsIGFicyBvZmZzZXQgJEFCU19PRkZTRVRfVkFMVUUsdGltZXN0YW1wICRPRkZTRVRfREFURSIKCiAgIyBDaGVjayBob3cgZnJlc2ggaXMgdGhlIG9mZnNldCBtZWFzdXJlbWVudCB0byBwcm90ZWN0CiAgIyBmcm9tIGxvb2tpbmcgYXQgdGhlIG9sZCBsb2cgdGhhdCBoYXMgbm90IGJlZW4gY2xlYW5lZCBmcm9tIHRoZSBzeXN0ZW0KICBsb2NhbCBDVVJSRU5UX1RJTUU9IiQoZGF0ZSArJXMuJU4pIiAjIGN1cnJlbnQgZGF0ZSBpbiBuYW5vc2Vjb25kcwogIGxvY2FsIE9GRlNFVF9USU1FU1RBTVA9IiQoZGF0ZSArJXMuJU4gLWQgIiRPRkZTRVRfREFURSIpIiAjIG1lYXN1cmVtZW50IGRhdGUgaW4gbnMKICBsb2NhbCBUSU1FX0RJRkY9JChhd2sgJ3twcmludCAkMS0kMn0nIDw8PCIke0NVUlJFTlRfVElNRX0gJHtPRkZTRVRfVElNRVNUQU1QfSIpCiAgZWNobyAiJHtBQlNfT0ZGU0VUX1ZBTFVFfSIKICBpZiAkKGdyZWF0ZXIgJFRJTUVfRElGRiAkU1lOQ19BR0UpOyB0aGVuCiAgICByZXR1cm4gMQogIGVsc2UKICAgIHJldHVybiAwCiAgZmkKfQoKIyBDaGVjayBpZiBQVFAgaXMgc3luY2VkCiMgQVJHVU1FTlRTOgojICAgbm9uZQojIEdMT0JBTDoKIyAgIFNZTkNfTUFSS0VSX1BBVEggLSBGaWxlIGZvciBzdGFydGluZyBjaHJvbnlkIGNvbmRpdGlvbmFsbHkuIFVzZWQgdG8gZmluZCB0aGUgCiMgICAgICBsYXN0IGtub3duIHB0cCBzeW5jIHN0YXRlIGFuZCBhcHBseSBoeXN0ZXJlc2lzIHRocmVzaG9sZAojICAgTUFYX09GRlNFVCAtIE1heGltdW0gYWxsb3dlZCBjbG9jayBvZmZzZXQgaW4gbmFub3NlY29uZHMKIyAgIE9GRlNFVF9USFJFU0hPTEQgLSBoeXN0ZXJlc2lzIHRocmVzaG9sZAojICAgQUJTX09GRlNFVF9WQUxVRSAtIFBUUCBjbG9jayBvZmZzZXQKIyBPVVRQVVQ6CiMgICBub25lCiMgUkVUVVJOOgojICAgMCBpZiB0aGUgb2Zmc2V0IGlzIHdpdGhpbiB0aGUgYm91bmRhcmllcywgMSBpZiBub3QKcHRwX3N5bmNlZCgpIHsKICBkZWNsYXJlIC1pIE9GRlNFVAogIE9GRlNFVD0kKGdldF9wdHBfb2Zmc2V0KQogIGlmIFtbICQ/IC1uZSAwIF1dOyB0aGVuCiAgICBsb2dfZGVidWcgIk5vIHZhbGlkIHB0cCBvZmZzZXQuIgogICAgcmV0dXJuIDEKICBmaQogIGlmIFtbIC1mICIkU1lOQ19NQVJLRVJfUEFUSCIgXV07IHRoZW4KICAgIGxvZ19kZWJ1ZyAiTGFzdCBrbm93biBwdHAgc3RhdGUgLSBzeW5jaHJvbml6ZWQiCiAgICAoKE1BWF9PRkZTRVQ9TUFYX09GRlNFVCtPRkZTRVRfVEhSRVNIT0xEKSkKICBlbHNlCiAgICBsb2dfZGVidWcgIkxhc3Qga25vd24gcHRwIHN0YXRlIC0gdW5zeW5jaHJvbml6ZWQiCiAgICAoKE1BWF9PRkZTRVQ9TUFYX09GRlNFVC1PRkZTRVRfVEhSRVNIT0xEKSkKICBmaQogIGlmIFsgJE9GRlNFVCAtZ3QgJE1BWF9PRkZTRVQgXTsgdGhlbgogICAgcmV0dXJuIDEKICBmaQogIHJldHVybiAwCn0KCgojIElmIHB0cCBpcyBzeW5jZWQgYW5kIHRoZSBvZmZzZXQgaXMgdmFsaWQsIGNyZWF0ZSBjaHJvbnlkIG1hcmtlcgojIE90aGVyd2lzZSBkZWxldGUgdGhlIG1hcmtlcgptYWluKCkgewogIGlmIHB0cF9zeW5jZWQ7IHRoZW4KICAgIGxvZ19kZWJ1ZyAiZW5zdXJlICRTWU5DX01BUktFUl9QQVRIIGV4aXN0cyIKICAgIHRvdWNoICRTWU5DX01BUktFUl9QQVRICiAgZWxzZQogICAgbG9nX2RlYnVnICJlbnN1cmUgJFNZTkNfTUFSS0VSX1BBVEggZG9lcyBub3QgZXhpc3QiCiAgICBybSAkU1lOQ19NQVJLRVJfUEFUSCAmPiAvZGV2L251bAogIGZpCn0KCmlmIFtbICIke0JBU0hfU09VUkNFWzBdfSIgPSAiJHswfSIgXV07IHRoZW4KICBtYWluICIke0B9IgogIGV4aXQgJD8KZmkK
                mode: 493
                path: /usr/local/bin/ptp-sync-check
              - contents:
                  source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKIyBSdW4gUFRQIHN0YXRlIGV2YWx1YXRpb24gc2NyaXB0IGFuZCByZXN0YXJ0IHRoZSBjaHJvbnlkLnNlcnZpY2UKL3Vzci9sb2NhbC9iaW4vcHRwLXN5bmMtY2hlY2sKL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBjaHJvbnlkLnNlcnZpY2U=
                mode: 493
                path: /usr/local/bin/restart-chronyd
            systemd:
              units:
              - contents: |
                  [Unit]
                  Description=Restart chronyd

                  [Service]
                  Type=oneshot
                  Environment=MAX_OFFSET=100000
                  Environment=OFFSET_THRESHOLD=20000
                  Environment=SYNC_AGE=600
                  ExecStart=/usr/local/bin/restart-chronyd
                name: chronyd-restart.service
              - contents: |
                  [Unit]
                  Description=Restart chronyd periodically

                  [Timer]
                  OnCalendar=*:0/5

                  [Install]
                  WantedBy=timers.target
                enabled: true
                name: chronyd-restart.timer
              - dropins:
                - contents: |-
                    [Unit]
                    ConditionPathExists=!/var/run/ptp/insync
                  name: 20-conditional-start.conf
                name: chronyd.service
    06-kdump-master.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: master
          name: 06-kdump-enable-master
        spec:
          config:
            ignition:
              version: 3.2.0
            systemd:
              units:
              - enabled: true
                name: kdump.service
          kernelArguments:
            - crashkernel=256M
    06-kdump-worker.yaml: |
        # Automatically generated by extra-manifests-builder
        # Do not make changes directly.
        apiVersion: machineconfiguration.openshift.io/v1
        kind: MachineConfig
        metadata:
          labels:
            machineconfiguration.openshift.io/role: worker
          name: 06-kdump-enable-worker
        spec:
          config:
            ignition:
              version: 3.2.0
            systemd:
              units:
              - enabled: true
                name: kdump.service
          kernelArguments:
            - crashkernel=256M
kind: ConfigMap
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "1"
    name: cluster1
    namespace: cluster1
---
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "2"
    name: cluster1
spec:
    hubAcceptsClient: true
---
apiVersion: agent.open-cluster-management.io/v1
kind: KlusterletAddonConfig
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "2"
    name: cluster1
    namespace: cluster1
spec:
    applicationManager:
        enabled: false
    certPolicyController:
        enabled: false
    clusterLabels:
        cloud: auto-detect
        vendor: auto-detect
    clusterName: cluster1
    clusterNamespace: cluster1
    iamPolicyController:
        enabled: false
    policyController:
        enabled: true
    searchCollector:
        enabled: false
